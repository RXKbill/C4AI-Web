<!doctype html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <title>驭能能源管理系统</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Premium Multipurpose Admin & Dashboard Template" name="description">
        <meta content="Themesbrand" name="author">

        <!-- plugin css -->
        <link href="static/css/jquery-jvectormap-1.2.2.css" rel="stylesheet" type="text/css">

        <!-- preloader css -->
        <link rel="stylesheet" href="static/css/preloader.min.css" type="text/css">

        <!-- Bootstrap Css -->
        <link href="static/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css">
        <!-- Icons Css -->
        <link href="static/css/icons.min.css" rel="stylesheet" type="text/css">
        <!-- App Css-->
        <link href="static/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">

        <!-- 添加在其他script标签之前 -->
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
        <style>
            /* 报告样式 */
            .report-content {
                padding: 20px;
                max-width: 210mm; /* A4 宽度 */
                margin: 0 auto;
                font-family: "Microsoft YaHei", Arial, sans-serif;
                background-color: white;
                color: black;
            }
            .report-content h1 { 
                font-size: 24px; 
                margin-bottom: 20px;
                color: black;
            }
            .report-content h2 { 
                font-size: 20px; 
                margin-top: 25px;
                color: black;
            }
            .report-content h3 { 
                font-size: 18px; 
                margin-top: 20px;
                color: black;
            }
            .report-content table {
                width: 100%;
                border-collapse: collapse;
                margin: 15px 0;
                background-color: white;
            }
            .report-content th, .report-content td {
                border: 1px solid #000;
                padding: 8px;
                text-align: left;
                color: black;
            }
            .report-content th { 
                background-color: #f0f0f0;
                font-weight: bold;
            }
            .report-content p {
                margin: 10px 0;
                color: black;
            }
            .report-content ul, .report-content ol {
                margin: 10px 0;
                padding-left: 20px;
                color: black;
            }
            .report-content li {
                margin: 5px 0;
            }
            .report-chart {
                width: 100%;
                max-width: 800px;
                height: 300px;
                margin: 20px 0;
            }
            @media print {
                .report-content { 
                    padding: 0;
                    background-color: white;
                }
            }
            
            /* 资源面板样式 */
            .resource-panel {
                background: #f8f9fa;
                border-radius: 8px;
                padding: 15px;
                height: 100%;
            }
            
            /* 更新资源项样式 */
            .resource-item {
                background: var(--bs-card-bg);
                border: 1px solid var(--bs-border-color);
                border-radius: var(--bs-border-radius);
                padding: 0.75rem;
                margin-bottom: 0.75rem;
                cursor: move;
                transition: all 0.2s;
                position: relative;
            }
            
            .resource-item:hover {
                transform: translateY(-2px);
                box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
            }
            
            .resource-item .badge {
                position: absolute;
                right: 0.75rem;
                top: 50%;
                transform: translateY(-50%);
            }
            
            /* 调度时间轴样式优化 */
            .schedule-timeline {
                background: var(--bs-card-bg);
                border: 1px solid var(--bs-border-color);
                border-radius: var(--bs-border-radius);
                padding: 1.25rem;
            }
            
            .timeline-grid {
                height: 300px;
                background: 
                    linear-gradient(90deg, rgba(var(--bs-primary-rgb), 0.1) 1px, transparent 1px) 0 0 / 8.33% 100%,
                    linear-gradient(0deg, rgba(var(--bs-primary-rgb), 0.1) 1px, transparent 1px) 0 0 / 100% 25%;
                border: 1px solid var(--bs-border-color);
                border-radius: var(--bs-border-radius);
                position: relative;
            }
            
            .schedule-item {
                position: absolute;
                background: var(--bs-primary);
                color: white;
                padding: 0.5rem;
                border-radius: var(--bs-border-radius-sm);
                font-size: 0.875rem;
                cursor: move;
                z-index: 1;
            }
            
            .schedule-item:hover {
                box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
            }
            
            /* 拖拽相关样式 */
            .dragging {
                opacity: 0.5;
            }
            
            .drop-target {
                background-color: rgba(0,123,255,0.1);
            }

            /* 时间轴样式 */
            .timeline-vertical {
                position: relative;
                padding-left: 40px;
            }

            .timeline-item {
                position: relative;
                padding-bottom: 1.5rem;
                border-left: 2px solid #e9ecef;
            }

            .timeline-marker {
                position: absolute;
                left: -41px;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                text-align: center;
                line-height: 30px;
                color: white;
            }

            .timeline-content {
                padding: 0.5rem 1rem;
                background: var(--bs-card-bg);
                border-radius: 0.25rem;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            }

            /* 为所有预测图表容器添加统一的样式类 */
            .prediction-chart {
                height: 280px; /* 统一设置所有图表容器高度 */
                min-height: 280px; /* 确保最小高度 */
            }
        </style>

        <!-- 添加关键资源预加载 -->
        <link rel="preload" href="static/js/chart.min.js" as="script">
        <link rel="preload" href="static/css/bootstrap.min.css" as="style">
        
        <!-- 添加资源提示 -->
        <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
        <link rel="preconnect" href="https://cdnjs.cloudflare.com">
        
        <!-- 添加PWA支持 -->
        <link rel="manifest" href="manifest.json">
        <meta name="theme-color" content="#4F8CBE">

        /* 添加响应式布局优化 */
        @media (max-width: 768px) {
            .metric-card {
                margin-bottom: 1rem;
            }
            
            .chart-container {
                height: 250px !important;
            }
            
            .timeline-vertical {
                padding-left: 20px;
            }
            
            .resource-panel {
                margin-bottom: 1rem;
            }
            
            .schedule-timeline {
                overflow-x: auto;
            }
        }

    </head>

    <body data-layout-mode="dark" data-topbar="dark" data-sidebar="dark" class="sidebar-enable">

    <!-- <body data-layout="horizontal"> -->

        <!-- Begin page -->
        <div id="layout-wrapper">
            <header id="page-topbar">
                <div class="navbar-header">
                    <div class="d-flex">
                        <!-- LOGO -->
                        <div class="navbar-brand-box">
                            <a href="" class="logo logo-dark">
                                <span class="logo-sm">
                                    <img src="static/picture/logo.png" alt="" height="24">
                                </span>
                                <span class="logo-lg">
                                    <img src="static/picture/logo.png" alt="" height="24"> <span class="logo-txt">驭能能源管理系统</span>
                                </span>
                            </a>

                            <a href="" class="logo logo-light">
                                <span class="logo-sm">
                                    <img src="static/picture/logo.png" alt="" height="24">
                                </span>
                                <span class="logo-lg">
                                    <img src="static/picture/logo.png" alt="" height="24"> <span class="logo-txt">驭能能源管理系统</span>
                                </span>
                            </a>
                        </div>

                        <button type="button" class="btn btn-sm px-3 font-size-16 header-item" id="vertical-menu-btn">
                            <i class="fa fa-fw fa-bars"></i>
                        </button>

                        <!-- App Search-->
                        <form class="app-search d-none d-lg-block">
                            <div class="position-relative">
                                <input type="text" class="form-control" placeholder="Search...">
                                <button class="btn btn-primary" type="button"><i class="bx bx-search-alt align-middle"></i></button>
                            </div>
                        </form>
                    </div>

                    <div class="d-flex">

                        <div class="dropdown d-inline-block d-lg-none ms-2">
                            <button type="button" class="btn header-item" id="page-header-search-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i data-feather="search" class="icon-lg"></i>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-search-dropdown">
        
                                <form class="p-3">
                                    <div class="form-group m-0">
                                        <div class="input-group">
                                            <input type="text" class="form-control" placeholder="Search ..." aria-label="Search Result">

                                            <button class="btn btn-primary" type="submit"><i class="mdi mdi-magnify"></i></button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <div class="dropdown d-none d-sm-inline-block">
                            <button type="button" class="btn header-item" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img id="header-lang-img" src="static/picture/cn.png" alt="Header Language" height="16">
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">

                                <!-- item-->
                                <a href="javascript:void(0);" class="dropdown-item notify-item language" data-lang="en">
                                    <img src="static/picture/cn.png" alt="user-image" class="me-1" height="12"> <span class="align-middle">Chinese</span>
                                </a>
                                <!-- item-->
                                <a href="javascript:void(0);" class="dropdown-item notify-item language" data-lang="sp">
                                    <img src="static/picture/spain.jpg" alt="user-image" class="me-1" height="12"> <span class="align-middle">Spanish</span>
                                </a>

                                <!-- item-->
                                <a href="javascript:void(0);" class="dropdown-item notify-item language" data-lang="gr">
                                    <img src="static/picture/germany.jpg" alt="user-image" class="me-1" height="12"> <span class="align-middle">German</span>
                                </a>

                                <!-- item-->
                                <a href="javascript:void(0);" class="dropdown-item notify-item language" data-lang="it">
                                    <img src="static/picture/italy.jpg" alt="user-image" class="me-1" height="12"> <span class="align-middle">Italian</span>
                                </a>

                                <!-- item-->
                                <a href="javascript:void(0);" class="dropdown-item notify-item language" data-lang="ru">
                                    <img src="static/picture/russia.jpg" alt="user-image" class="me-1" height="12"> <span class="align-middle">Russian</span>
                                </a>
                            </div>
                        </div>

                        <div class="dropdown d-none d-sm-inline-block">
                            <button type="button" class="btn header-item" id="mode-setting-btn">
                                <i data-feather="moon" class="icon-lg layout-mode-dark"></i>
                                <i data-feather="sun" class="icon-lg layout-mode-light"></i>
                            </button>
                        </div>

                        <div class="dropdown d-none d-lg-inline-block ms-1">
                            <button type="button" class="btn header-item" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i data-feather="grid" class="icon-lg"></i>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end">
                                <div class="p-2">
                                    <div class="row g-0">
                                        <div class="col">
                                            <a class="dropdown-icon-item" href="#">
                                                <img src="static/picture/github.png" alt="Github">
                                                <span>GitHub</span>
                                            </a>
                                        </div>
                                        <div class="col">
                                            <a class="dropdown-icon-item" href="#">
                                                <img src="static/picture/bitbucket.png" alt="bitbucket">
                                                <span>Bitbucket</span>
                                            </a>
                                        </div>
                                        <div class="col">
                                            <a class="dropdown-icon-item" href="#">
                                                <img src="static/picture/dribbble.png" alt="dribbble">
                                                <span>Dribbble</span>
                                            </a>
                                        </div>
                                    </div>

                                    <div class="row g-0">
                                        <div class="col">
                                            <a class="dropdown-icon-item" href="#">
                                                <img src="static/picture/dropbox.png" alt="dropbox">
                                                <span>Dropbox</span>
                                            </a>
                                        </div>
                                        <div class="col">
                                            <a class="dropdown-icon-item" href="#">
                                                <img src="static/picture/mail_chimp.png" alt="mail_chimp">
                                                <span>Mail Chimp</span>
                                            </a>
                                        </div>
                                        <div class="col">
                                            <a class="dropdown-icon-item" href="#">
                                                <img src="static/picture/slack.png" alt="slack">
                                                <span>Slack</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item noti-icon position-relative" id="page-header-notifications-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i data-feather="bell" class="icon-lg"></i>
                                <span class="badge bg-danger rounded-pill">5</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-notifications-dropdown">
                                <div class="p-3">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <h6 class="m-0"> Notifications </h6>
                                        </div>
                                        <div class="col-auto">
                                            <a href="#!" class="small text-reset text-decoration-underline"> Unread (3)</a>
                                        </div>
                                    </div>
                                </div>
                                <div data-simplebar="" style="max-height: 230px;">
                                    <a href="#!" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="flex-shrink-0 me-3">
                                                <img src="static/picture/avatar-3.jpg" class="rounded-circle avatar-sm" alt="user-pic">
                                            </div>
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1">James Lemire</h6>
                                                <div class="font-size-13 text-muted">
                                                    <p class="mb-1">It will seem like simplified Chinese.</p>
                                                    <p class="mb-0"><i class="mdi mdi-clock-outline"></i> <span>1 hours ago</span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                    <a href="#!" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="flex-shrink-0 avatar-sm me-3">
                                                <span class="avatar-title bg-primary rounded-circle font-size-16">
                                                    <i class="bx bx-cart"></i>
                                                </span>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1">Your order is placed</h6>
                                                <div class="font-size-13 text-muted">
                                                    <p class="mb-1">If several languages coalesce the grammar</p>
                                                    <p class="mb-0"><i class="mdi mdi-clock-outline"></i> <span>3 min ago</span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                    <a href="#!" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="flex-shrink-0 avatar-sm me-3">
                                                <span class="avatar-title bg-success rounded-circle font-size-16">
                                                    <i class="bx bx-badge-check"></i>
                                                </span>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1">Your item is shipped</h6>
                                                <div class="font-size-13 text-muted">
                                                    <p class="mb-1">If several languages coalesce the grammar</p>
                                                    <p class="mb-0"><i class="mdi mdi-clock-outline"></i> <span>3 min ago</span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>

                                    <a href="#!" class="text-reset notification-item">
                                        <div class="d-flex">
                                            <div class="flex-shrink-0 me-3">
                                                <img src="static/picture/avatar-6.jpg" class="rounded-circle avatar-sm" alt="user-pic">
                                            </div>
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1">Salena Layfield</h6>
                                                <div class="font-size-13 text-muted">
                                                    <p class="mb-1">As a skeptical Cambridge friend of mine occidental.</p>
                                                    <p class="mb-0"><i class="mdi mdi-clock-outline"></i> <span>1 hours ago</span></p>
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                                <div class="p-2 border-top d-grid">
                                    <a class="btn btn-sm btn-link font-size-14 text-center" href="javascript:void(0)">
                                        <i class="mdi mdi-arrow-right-circle me-1"></i> <span>View More..</span> 
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item right-bar-toggle me-2">
                                <i data-feather="settings" class="icon-lg"></i>
                            </button>
                        </div>

                        <div class="dropdown d-inline-block">
                            <button type="button" class="btn header-item bg-soft-light border-start border-end" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img class="rounded-circle header-profile-user" src="static/picture/avatar-1.jpg" alt="Header Avatar">
                                <span class="d-none d-xl-inline-block ms-1 fw-medium">张明</span>
                                <i class="mdi mdi-chevron-down d-none d-xl-inline-block"></i>
                            </button>
                            <div class="dropdown-menu dropdown-menu-end">
                                <!-- item-->
                                <a class="dropdown-item" href="apps-contacts-profile.html"><i class="mdi mdi-face-profile font-size-16 align-middle me-1"></i> Profile</a>
                                <a class="dropdown-item" href="auth-lock-screen.html"><i class="mdi mdi-lock font-size-16 align-middle me-1"></i> Lock screen</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="auth-logout.html"><i class="mdi mdi-logout font-size-16 align-middle me-1"></i> Logout</a>
                            </div>
                        </div>

                    </div>
                </div>
            </header>

            <!-- ========== Left Sidebar Start ========== -->
            <div class="vertical-menu">
                <div data-simplebar="" class="h-100">

                    <!--- Sidemenu -->
                    <div id="sidebar-menu">
                        <!-- Left Menu Start -->
                        <ul class="metismenu list-unstyled" id="side-menu">
                            <li class="menu-title" data-key="t-menu">View</li>

                            <li>
                                <a href="app-index.html">
                                    <i data-feather="home"></i>
                                    <span data-key="t-dashboard">数据总览</span>
                                </a>
                            </li>
                            <li class="menu-title mt-2" data-key="t-components">Basic</li>
                            <li>
                                <a href="javascript: void(0);" class="has-arrow">
                                    <i data-feather="users"></i>
                                    <span data-key="t-authentication">个人界面</span>
                                </a>
                                <ul class="sub-menu" aria-expanded="false">
                                    <li>
                                        <a href="app-contacts-profile.html">
                                            <span data-key="t-calendar">个人信息</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="app-calendar.html">
                                            <span data-key="t-calendar">日程表</span>
                                        </a>
                                    </li>
        
                                    <li>
                                        <a href="app-chat.html">
                                            <span data-key="t-chat">聊天</span>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <a href="app-contacts-list.html">
                                    <i data-feather="file-text"></i>
                                    <span data-key="t-pages">用户列表</span>
                                </a>
                            </li>

                            <li class="menu-title mt-2" data-key="t-components">Operations</li>

                            
                            <li>
                                <a href="app-system_management.html">
                                    <i data-feather="grid"></i>
                                    <span data-key="t-apps">系统设置</span>
                                </a>
                            </li>
                            <li>
                                <a href="app-data_management.html">
                                    <i data-feather="sliders"></i>
                                    <span data-key="t-tables">数据管理</span>
                                </a>
                            </li>
                            <li>
                                <a href="app-business_process.html">
                                    <i data-feather="briefcase"></i>
                                    <span data-key="t-components">业务处理</span>
                                </a>
                            </li>

                            <li>
                                <a href="app-equipment_management.html">
                                    <i data-feather="cpu"></i>
                                    <span data-key="t-icons">设备管理</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <!-- Sidebar -->
                </div>
            </div>
            <!-- Left Sidebar End -->

            <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
            <div class="main-content">
                <div class="page-content">
                    <div class="container-fluid">

                        <div class="container-fluid py-4">
                            <!-- 顶部状态栏 -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h1 class="h3">综合能源预测分析</h1>
                                        <div class="d-flex align-items-center">
                                            <button class="btn btn-outline-danger me-2">
                                                <i class="fas fa-exclamation-circle me-2"></i>
                                                <span class="badge bg-danger">3</span> 预警信息
                                            </button>
                                            <div class="d-print-none">
                                                <button id="exportReportBtn" class="btn btn-primary" onclick="handleExportReport()">
                                                    <i class="fas fa-download me-2"></i>导出报告
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                    
                           
                    
                            <!-- 主要内容区域 -->
                            <div class="row">
                                <!-- 左侧预测图表 -->
                                <div class="col-md-8">
                                    <div class="container-fluid">
                                        <div class="row g-4">
                                            <!-- 发电预测 -->
                                            <div class="col-md-6">
                                                <div class="card h-100">
                                                    <div class="card-header d-flex justify-content-between align-items-center bg-primary bg-gradient text-white">
                                                        <h5 class="mb-0">
                                                            <i class="fas fa-bolt me-2"></i>
                                                            发电预测
                                                        </h5>
                                                        <div>
                                                            <!-- 将button改为a标签，设置href属性 -->
                                                            <a href="app-power_generation_index.html" class="btn btn-sm btn-light ms-2" data-chart="power" title="查看详细发电数据">
                                                                <i class="fas fa-external-link-alt"></i>
                                                            </a>
                                                    </div>
                                                    </div>
                                                    <div class="card-body d-flex flex-column">
                                                        <div class="chart-container position-relative" style="height: 300px;">
                                                            <!-- 添加加载遮罩 -->
                                                            <div class="chart-loading-overlay d-none position-absolute w-100 h-100">
                                                                <div class="spinner-border text-primary" role="status">
                                                                    <span class="visually-hidden">加载中...</span>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- 添加错误提示 -->
                                                            <div class="chart-error-message d-none position-absolute w-100 h-100">
                                                                <i class="fas fa-exclamation-circle text-danger"></i>
                                                                <p>数据加载失败，请稍后重试</p>
                                                                <button class="btn btn-sm btn-primary reload-chart">重新加载</button>
                                                            </div>
                                                            
                                                            <canvas id="powerPredictionChart"></canvas>
                                                        </div>
                                                        <div class="row mt-3"> <!-- 底部状态栏 -->
                                                            <div class="col-4 text-center">
                                                                <h6 class="text-muted mb-1">当前发电量</h6>
                                                                <h4 class="mb-0">256.8 MW</h4>
                                                    </div>
                                                            <div class="col-4 text-center border-start border-end">
                                                                <h6 class="text-muted mb-1">预测峰值</h6>
                                                                <h4 class="mb-0">320.5 MW</h4>
                                                            </div>
                                                            <div class="col-4 text-center">
                                                                <h6 class="text-muted mb-1">预测准确率</h6>
                                                                <h4 class="text-success mb-0">95.2%</h4>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                    
                                            <!-- 负荷预测 -->
                                            <div class="col-md-6">
                                                <div class="card h-100">
                                                    <div class="card-header d-flex justify-content-between align-items-center bg-info bg-gradient text-white">
                                                        <h5 class="mb-0">
                                                            <i class="fas fa-plug me-2"></i>
                                                            负荷预测
                                                        </h5>
                                                        <div>
                                                            <button class="btn btn-sm btn-light ms-2" data-chart="load">
                                                                <i class="fas fa-external-link-alt"></i>
                                                        </button>
                                                        </div>
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="chart-container position-relative" style="height:300px;">
                                                            <canvas id="loadPredictionChart"></canvas>
                                                        </div>
                                                        <div class="row mt-3">
                                                            <div class="col-4 text-center">
                                                                <h6 class="text-muted mb-1">当前负荷</h6>
                                                                <h4 class="mb-0">189.2 MW</h4>
                                                    </div>
                                                            <div class="col-4 text-center border-start border-end">
                                                                <h6 class="text-muted mb-1">预测峰值</h6>
                                                                <h4 class="mb-0">245.8 MW</h4>
                                                            </div>
                                                            <div class="col-4 text-center">
                                                                <h6 class="text-muted mb-1">负荷率</h6>
                                                                <h4 class="text-warning mb-0">78.5%</h4>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                    
                                            <!-- 电价预测 -->
                                            <div class="col-md-6">
                                                <div class="card h-100">
                                                    <div class="card-header d-flex justify-content-between align-items-center bg-success bg-gradient text-white">
                                                        <h5 class="mb-0">
                                                            <i class="fas fa-yen-sign me-2"></i>
                                                            电价预测
                                                        </h5>
                                                        <div>
                                                            <button class="btn btn-sm btn-light ms-2" data-chart="price">
                                                                <i class="fas fa-external-link-alt"></i>
                                                        </button>
                                                        </div>
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="chart-container position-relative" style="height:300px;">
                                                            <canvas id="pricePredictionChart"></canvas>
                                                        </div>
                                                        <div class="row mt-3">
                                                            <div class="col-4 text-center">
                                                                <h6 class="text-muted mb-1">当前电价</h6>
                                                                <h4 class="mb-0">0.68 ¥</h4>
                                                    </div>
                                                            <div class="col-4 text-center border-start border-end">
                                                                <h6 class="text-muted mb-1">预测峰值</h6>
                                                                <h4 class="mb-0">0.85 ¥</h4>
                                                            </div>
                                                            <div class="col-4 text-center">
                                                                <h6 class="text-muted mb-1">波动率</h6>
                                                                <h4 class="text-danger mb-0">+12.3%</h4>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                    
                                            <!-- 充电预测 -->
                                            <div class="col-md-6">
                                                <div class="card h-100">
                                                    <div class="card-header d-flex justify-content-between align-items-center bg-warning bg-gradient text-white">
                                                        <h5 class="mb-0">
                                                            <i class="fas fa-charging-station me-2"></i>
                                                            充电预测
                                                        </h5>
                                                        <div>
                                                            <!-- <button class="btn btn-light btn-sm" id="chargingRangeBtn">
                                                                <i class="fas fa-calendar-alt me-1"></i>24h
                                                            </button> -->
                                                            <button class="btn btn-sm btn-light ms-2" data-chart="charging">
                                                                <i class="fas fa-external-link-alt"></i>
                                                        </button>
                                                        </div>
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="chart-container position-relative" style="height:300px;">
                                                            <canvas id="chargingPredictionChart"></canvas>
                                                        </div>
                                                        <div class="row mt-3">
                                                            <div class="col-4 text-center">
                                                                <h6 class="text-muted mb-1">当前充电量</h6>
                                                                <h4 class="mb-0">45.6 kW</h4>
                                                    </div>
                                                            <div class="col-4 text-center border-start border-end">
                                                                <h6 class="text-muted mb-1">预测峰值</h6>
                                                                <h4 class="mb-0">95.0 kW</h4>
                                                            </div>
                                                            <div class="col-4 text-center">
                                                                <h6 class="text-muted mb-1">使用率</h6>
                                                                <h4 class="text-primary mb-0">76.5%</h4>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 预测准确率统计模块 -->
                                    <div class="row mt-4"> <!-- 添加 mt-4 类增加上边距 -->
                                        <div class="col-12">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h4 class="card-title">预测准确率统计(近30天)</h4>
                                            <div class="btn-group">
                                                        <button class="btn btn-outline-secondary btn-sm" data-type="mape">MAPE</button>
                                                        <button class="btn btn-outline-secondary btn-sm active" data-type="rmse">RMSE</button>
                                                        <button class="btn btn-outline-secondary btn-sm" data-type="mae">MAE</button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                                    <div class="row mb-4">
                                                        <div class="col-md-3">
                                                            <div class="accuracy-stat text-center">
                                                                <h6 class="text-muted">发电预测</h6>
                                                                <h3 class="text-success">95.2%</h3>
                                                                <small class="text-success"><i class="fas fa-arrow-up"></i> 2.1%</small>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="accuracy-stat text-center">
                                                                <h6 class="text-muted">负荷预测</h6>
                                                                <h3 class="text-primary">93.8%</h3>
                                                                <small class="text-success"><i class="fas fa-arrow-up"></i> 1.5%</small>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="accuracy-stat text-center">
                                                                <h6 class="text-muted">电价预测</h6>
                                                                <h3 class="text-warning">91.5%</h3>
                                                                <small class="text-danger"><i class="fas fa-arrow-down"></i> 0.8%</small>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <div class="accuracy-stat text-center">
                                                                <h6 class="text-muted">充电预测</h6>
                                                                <h3 class="text-info">94.3%</h3>
                                                                <small class="text-success"><i class="fas fa-arrow-up"></i> 1.2%</small>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <canvas id="accuracyChart"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 预测详情数据模块 -->
                                    <div class="card">
                                        <div class="card-header">
                                            <div class="row align-items-center">
                                                <div class="col">
                                                    <h4 class="card-title">预测详情数据</h4>
                                                </div>
                                                <div class="col-auto">
                                                    <div class="d-flex gap-2">
                                                        <button class="btn btn-light btn-sm" data-bs-toggle="collapse" data-bs-target="#filterPanel">
                                                            <i class="fas fa-filter me-1"></i>高级筛选
                                                        </button>
                                                        <button class="btn btn-primary btn-sm" id="exportData">
                                                            <i class="fas fa-download me-1"></i>导出数据
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="collapse" id="filterPanel">
                                            <div class="card-body border-bottom">
                                                <div class="row g-3">
                                                    <div class="col-md-3">
                                                        <label class="form-label">预测类型</label>
                                                        <select class="form-select form-select-sm" multiple>
                                                            <option value="power">发电预测</option>
                                                            <option value="load">负荷预测</option>
                                                            <option value="price">电价预测</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">误差范围</label>
                                                        <div class="input-group input-group-sm">
                                                            <input type="number" class="form-control" placeholder="最小值">
                                                            <span class="input-group-text">-</span>
                                                            <input type="number" class="form-control" placeholder="最大值">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">时间范围</label>
                                                        <input type="datetime-local" class="form-control form-control-sm">
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">状态</label>
                                                        <select class="form-select form-select-sm">
                                                            <option value="">全部</option>
                                                            <option value="normal">正常</option>
                                                            <option value="warning">警告</option>
                                                            <option value="error">错误</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="text-end mt-3">
                                                    <button class="btn btn-light btn-sm me-2">重置</button>
                                                    <button class="btn btn-primary btn-sm">应用筛选</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-rep-plugin">
                                                <div class="table-responsive mb-0" data-pattern="priority-columns">
                                                    <table class="table table-striped table-editable">
                                                    <thead>
                                                        <tr>
                                                                <th data-priority="1">时间</th>
                                                                <th data-priority="1">预测类型</th>
                                                                <th data-priority="2">预测值</th>
                                                                <th data-priority="2">实际值</th>
                                                                <th data-priority="3">误差率</th>
                                                                <th data-priority="3">置信度</th>
                                                                <th data-priority="4">预测模型</th>
                                                                <th data-priority="4">状态</th>
                                                                <th data-priority="1">操作</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                                <td>2024-03-21 08:00</td>
                                                                <td>发电预测</td>
                                                                <td data-field="predicted">245.6 MW</td>
                                                                <td data-field="actual">242.8 MW</td>
                                                                <td>1.15%</td>
                                                                <td>95%</td>
                                                                <td>Predenergy</td>
                                                                <td><span class="badge bg-success">正常</span></td>
                                                                <td>
                                                                    <a class="btn btn-outline-secondary btn-sm edit" title="编辑">
                                                                        <i class="fas fa-pencil-alt"></i>
                                                                    </a>
                                                                </td>
                                                        </tr>
                                                        <tr>
                                                                <td>2024-03-21 09:00</td>
                                                                <td>负荷预测</td>
                                                                <td data-field="predicted">180.2 MW</td>
                                                                <td data-field="actual">195.5 MW</td>
                                                                <td>8.46%</td>
                                                                <td>87%</td>
                                                                <td>GRU-B</td>
                                                                <td><span class="badge bg-warning">警告</span></td>
                                                                <td>
                                                                    <a class="btn btn-outline-secondary btn-sm edit" title="编辑">
                                                                        <i class="fas fa-pencil-alt"></i>
                                                                    </a>
                                                                </td>
                                                        </tr>
                                                        <tr>
                                                                <td>2024-03-21 10:00</td>
                                                                <td>电价预测</td>
                                                                <td data-field="predicted">0.52 ¥/kWh</td>
                                                                <td data-field="actual">0.51 ¥/kWh</td>
                                                                <td>1.96%</td>
                                                                <td>93%</td>
                                                                <td>XGBoost-C</td>
                                                                <td><span class="badge bg-success">正常</span></td>
                                                                <td>
                                                                    <a class="btn btn-outline-secondary btn-sm edit" title="编辑">
                                                                        <i class="fas fa-pencil-alt"></i>
                                                                    </a>
                                                                </td>
                                                        </tr>
                                                        <tr>
                                                                <td>2024-03-21 11:00</td>
                                                                <td>发电预测</td>
                                                                <td data-field="predicted">312.8 MW</td>
                                                                <td data-field="actual">298.5 MW</td>
                                                                <td>4.79%</td>
                                                                <td>91%</td>
                                                                <td>Predenergy</td>
                                                                <td><span class="badge bg-success">正常</span></td>
                                                                <td>
                                                                    <a class="btn btn-outline-secondary btn-sm edit" title="编辑">
                                                                        <i class="fas fa-pencil-alt"></i>
                                                                    </a>
                                                                </td>
                                                        </tr>
                                                        <tr>
                                                                <td>2024-03-21 12:00</td>
                                                                <td>负荷预测</td>
                                                                <td data-field="predicted">225.4 MW</td>
                                                                <td data-field="actual">258.9 MW</td>
                                                                <td>14.82%</td>
                                                                <td>78%</td>
                                                                <td>GRU-B</td>
                                                                <td><span class="badge bg-danger">错误</span></td>
                                                                <td>
                                                                    <a class="btn btn-outline-secondary btn-sm edit" title="编辑">
                                                                        <i class="fas fa-pencil-alt"></i>
                                                                    </a>
                                                                </td>
                                                        </tr>
                                                        <tr>
                                                                <td>2024-03-21 13:00</td>
                                                                <td>电价预测</td>
                                                                <td data-field="predicted">0.68 ¥/kWh</td>
                                                                <td data-field="actual">0.65 ¥/kWh</td>
                                                                <td>4.62%</td>
                                                                <td>89%</td>
                                                                <td>XGBoost-C</td>
                                                                <td><span class="badge bg-success">正常</span></td>
                                                                <td>
                                                                    <a class="btn btn-outline-secondary btn-sm edit" title="编辑">
                                                                        <i class="fas fa-pencil-alt"></i>
                                                                    </a>
                                                                </td>
                                                        </tr>
                                                        <tr>
                                                                <td>2024-03-21 14:00</td>
                                                                <td>发电预测</td>
                                                                <td data-field="predicted">289.3 MW</td>
                                                                <td data-field="actual">265.7 MW</td>
                                                                <td>8.88%</td>
                                                                <td>85%</td>
                                                                <td>Predenergy</td>
                                                                <td><span class="badge bg-warning">警告</span></td>
                                                                <td>
                                                                    <a class="btn btn-outline-secondary btn-sm edit" title="编辑">
                                                                        <i class="fas fa-pencil-alt"></i>
                                                                    </a>
                                                                </td>
                                                        </tr>
                                                        <tr>
                                                                <td>2024-03-21 15:00</td>
                                                                <td>负荷预测</td>
                                                                <td data-field="predicted">198.6 MW</td>
                                                                <td data-field="actual">201.2 MW</td>
                                                                <td>1.29%</td>
                                                                <td>94%</td>
                                                                <td>GRU-B</td>
                                                                <td><span class="badge bg-success">正常</span></td>
                                                                <td>
                                                                    <a class="btn btn-outline-secondary btn-sm edit" title="编辑">
                                                                        <i class="fas fa-pencil-alt"></i>
                                                                    </a>
                                                                </td>
                                                        </tr>
                                                        <tr>
                                                                <td>2024-03-21 16:00</td>
                                                                <td>电价预测</td>
                                                                <td data-field="predicted">0.75 ¥/kWh</td>
                                                                <td data-field="actual">0.82 ¥/kWh</td>
                                                                <td>9.33%</td>
                                                                <td>83%</td>
                                                                <td>XGBoost-C</td>
                                                                <td><span class="badge bg-warning">警告</span></td>
                                                                <td>
                                                                    <a class="btn btn-outline-secondary btn-sm edit" title="编辑">
                                                                        <i class="fas fa-pencil-alt"></i>
                                                                    </a>
                                                                </td>
                                                        </tr>
                                                        <tr>
                                                                <td>2024-03-21 17:00</td>
                                                                <td>发电预测</td>
                                                                <td data-field="predicted">156.8 MW</td>
                                                                <td data-field="actual">182.3 MW</td>
                                                                <td>16.25%</td>
                                                                <td>76%</td>
                                                                <td>Predenergy</td>
                                                                <td><span class="badge bg-danger">错误</span></td>
                                                                <td>
                                                                    <a class="btn btn-outline-secondary btn-sm edit" title="编辑">
                                                                        <i class="fas fa-pencil-alt"></i>
                                                                    </a>
                                                                </td>
                                                        </tr>
                                                        <tr>
                                                                <td>2024-03-21 18:00</td>
                                                                <td>负荷预测</td>
                                                                <td data-field="predicted">234.5 MW</td>
                                                                <td data-field="actual">229.8 MW</td>
                                                                <td>2.05%</td>
                                                                <td>92%</td>
                                                                <td>GRU-B</td>
                                                                <td><span class="badge bg-success">正常</span></td>
                                                                <td>
                                                                    <a class="btn btn-outline-secondary btn-sm edit" title="编辑">
                                                                        <i class="fas fa-pencil-alt"></i>
                                                                    </a>
                                                                </td>
                                                        </tr>
                                                        <tr>
                                                                <td>2024-03-21 19:00</td>
                                                                <td>电价预测</td>
                                                                <td data-field="predicted">0.89 ¥/kWh</td>
                                                                <td data-field="actual">0.95 ¥/kWh</td>
                                                                <td>6.73%</td>
                                                                <td>88%</td>
                                                                <td>XGBoost-C</td>
                                                                <td><span class="badge bg-warning">警告</span></td>
                                                                <td>
                                                                    <a class="btn btn-outline-secondary btn-sm edit" title="编辑">
                                                                        <i class="fas fa-pencil-alt"></i>
                                                                    </a>
                                                                </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                            <!-- 分页控件 -->
                                            <div class="row mt-3">
                                                <div class="col-sm-12 col-md-5">
                                                    <div class="dataTables_info">
                                                        显示 1 到 3，共 24 条记录
                                                    </div>
                                                </div>
                                                <div class="col-sm-12 col-md-7">
                                                    <div class="dataTables_paginate paging_simple_numbers">
                                                        <ul class="pagination pagination-rounded justify-content-end">
                                                            <li class="paginate_button page-item previous disabled">
                                                                <a href="#" class="page-link"><i class="mdi mdi-chevron-left"></i></a>
                                                            </li>
                                                            <li class="paginate_button page-item active">
                                                                <a href="#" class="page-link">1</a>
                                                            </li>
                                                            <li class="paginate_button page-item">
                                                                <a href="#" class="page-link">2</a>
                                                            </li>
                                                            <li class="paginate_button page-item">
                                                                <a href="#" class="page-link">3</a>
                                                            </li>
                                                            <li class="paginate_button page-item next">
                                                                <a href="#" class="page-link"><i class="mdi mdi-chevron-right"></i></a>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                    
                                <!-- 右侧信息面板 -->
                                <div class="col-md-4">
                                    <!-- 实时气象信息卡片 -->
                                    <div class="card custom-card mb-4">
                                        <div class="card-header">
                                            <h5 class="mb-0">实时气象信息</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between mb-3">
                                                <span><i class="fas fa-wind me-2"></i>风速</span>
                                                <span>5.2 m/s</span>
                                            </div>
                                            <div class="d-flex justify-content-between mb-3">
                                                <span><i class="fas fa-sun me-2"></i>光照强度</span>
                                                <span>850 W/m²</span>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <span><i class="fas fa-temperature-high me-2"></i>温度</span>
                                                <span>25°C</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 决策建议卡片 -->
                                    <div class="card custom-card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">决策建议</h5>
                                            <div>
                                                <button class="btn btn-sm btn-light me-2" data-bs-toggle="modal" data-bs-target="#decisionHistoryModal">
                                                    <i class="fas fa-history me-1"></i>历史记录
                                                </button>
                                                <button class="btn btn-sm btn-primary" id="refreshSuggestions">
                                                    <i class="fas fa-sync-alt me-1"></i>刷新建议
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <!-- 决策概览区域 -->
                                            <div class="row mb-4">
                                                <div class="col-md-3">
                                                    <div class="card border">
                                                        <div class="card-body">
                                                            <h6 class="text-muted mb-2">今日建议数</h6>
                                                            <h3 class="mb-0" id="todaySuggestions">12条</h3>
                                                            <small class="text-success">
                                                                <i class="fas fa-arrow-up me-1"></i><span id="suggestionChange">较昨日+3条</span>
                                                            </small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="card border">
                                                        <div class="card-body">
                                                            <h6 class="text-muted mb-2">预期收益</h6>
                                                            <h3 class="mb-0" id="expectedProfit">¥35,500</h3>
                                                            <small class="text-success">
                                                                <i class="fas fa-arrow-up me-1"></i><span id="profitChange">+15.2%</span>
                                                            </small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="card border">
                                                        <div class="card-body">
                                                            <h6 class="text-muted mb-2">已采纳建议</h6>
                                                            <h3 class="mb-0" id="adoptedSuggestions">8条</h3>
                                                            <small class="text-muted">采纳率 <span id="adoptionRate">66.7%</span></small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="card border">
                                                        <div class="card-body">
                                                            <h6 class="text-muted mb-2">执行中建议</h6>
                                                            <h3 class="mb-0" id="inProgressSuggestions">5条</h3>
                                                            <small class="text-primary">完成率 <span id="completionRate">60%</span></small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- 建议列表 -->
                                            <div class="suggestion-timeline">
                                                <div class="d-flex justify-content-between align-items-center mb-3">
                                                    <h6 class="mb-0">最新决策建议</h6>
                                                    <div class="btn-group" id="suggestionTypeFilter">
                                                        <button class="btn btn-sm btn-outline-primary active" data-type="all">全部</button>
                                                        <button class="btn btn-sm btn-outline-primary" data-type="energy">能源需求</button>
                                                        <button class="btn btn-sm btn-outline-primary" data-type="production">生产优化</button>
                                                        <button class="btn btn-sm btn-outline-primary" data-type="maintenance">设备维护</button>
                                                    </div>
                                                </div>
                                                <div class="table-responsive">
                                                    <table class="table table-hover" id="suggestionTable">
                                                        <thead>
                                                            <tr>
                                                                <th>时间</th>
                                                                <th>类型</th>
                                                                <th>建议内容</th>
                                                                <th>预期收益</th>
                                                                <th>依据</th>
                                                                <th>状态</th>
                                                                <th>操作</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="suggestionTableBody">
                                                            <!-- 建议列表将通过JavaScript动态生成 -->
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 设备运行状态卡片 -->
                                    <div class="card custom-card mb-4">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">设备运行状态</h5>
                                            <button class="btn btn-sm btn-outline-primary" onclick="refreshDeviceStatus()">
                                                <i class="fas fa-sync-alt me-1"></i>刷新
                                            </button>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-3">
                                                <!-- 光伏设备状态 -->
                                                <div class="col-md-6">
                                                    <div class="device-status-card">
                                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                                            <div>
                                                                <h6 class="mb-0">光伏设备</h6>
                                                                <small class="text-muted">运行效率: 92%</small>
                                                            </div>
                                                            <div class="status-indicator">
                                                                <i class="fas fa-sun text-warning"></i>
                                                                <span class="badge bg-success">正常</span>
                                                            </div>
                                                        </div>
                                                        <div class="progress" style="height: 8px;">
                                                            <div class="progress-bar bg-success" role="progressbar" style="width: 92%" 
                                                                 aria-valuenow="92" aria-valuemin="0" aria-valuemax="100"></div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 风机设备状态 -->
                                                <div class="col-md-6">
                                                    <div class="device-status-card">
                                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                                            <div>
                                                                <h6 class="mb-0">风机设备</h6>
                                                                <small class="text-muted">运行效率: 85%</small>
                                                            </div>
                                                            <div class="status-indicator">
                                                                <i class="fas fa-wind text-info"></i>
                                                                <span class="badge bg-success">正常</span>
                                                            </div>
                                                        </div>
                                                        <div class="progress" style="height: 8px;">
                                                            <div class="progress-bar bg-info" role="progressbar" style="width: 85%" 
                                                                 aria-valuenow="85" aria-valuemin="0" aria-valuemax="100"></div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 储能设备状态 -->
                                                <div class="col-md-6">
                                                    <div class="device-status-card">
                                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                                            <div>
                                                                <h6 class="mb-0">储能设备</h6>
                                                                <small class="text-muted">充电状态: 75%</small>
                                                            </div>
                                                            <div class="status-indicator">
                                                                <i class="fas fa-battery-three-quarters text-primary"></i>
                                                                <span class="badge bg-success">充电中</span>
                                                            </div>
                                                        </div>
                                                        <div class="progress" style="height: 8px;">
                                                            <div class="progress-bar bg-primary" role="progressbar" style="width: 75%" 
                                                                 aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 充电设施状态 -->
                                                <div class="col-md-6">
                                                    <div class="device-status-card">
                                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                                            <div>
                                                                <h6 class="mb-0">充电设施</h6>
                                                                <small class="text-muted">使用率: 80%</small>
                                                            </div>
                                                            <div class="status-indicator">
                                                                <i class="fas fa-charging-station text-success"></i>
                                                                <span class="badge bg-success">运行中</span>
                                                            </div>
                                                        </div>
                                                        <div class="progress" style="height: 8px;">
                                                            <div class="progress-bar bg-success" role="progressbar" style="width: 80%" 
                                                                 aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <style>
                                    .device-status-card {
                                        background: rgba(0, 0, 0, 0.02);
                                        border-radius: 8px;
                                        padding: 15px;
                                    }

                                    .status-indicator {
                                        display: flex;
                                        align-items: center;
                                        gap: 10px;
                                    }

                                    .status-indicator i {
                                        font-size: 1.2rem;
                                    }

                                    .progress {
                                        background-color: rgba(0, 0, 0, 0.05);
                                    }
                                    </style>

                                    <!-- 系统状态卡片 -->
                                    <div class="card custom-card mb-4">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">系统状态</h5>
                                            <div class="btn-group">
                                                <button class="btn btn-sm btn-outline-primary active">实时</button>
                                                <button class="btn btn-sm btn-outline-primary">24h</button>
                                                <button class="btn btn-sm btn-outline-primary">7天</button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <!-- 系统性能指标图表 -->
                                            <div class="mb-4">
                                                <canvas id="systemPerformanceChart"></canvas>
                                            </div>

                                            <!-- 系统状态指标 -->
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <div class="p-3 border rounded bg-light">
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <div>
                                                                <h6 class="mb-1">预测模型状态</h6>
                                                                <span class="badge bg-success">运行中</span>
                                                            </div>
                                                            <div class="text-end">
                                                                <small class="d-block text-muted">响应时间</small>
                                                                <strong class="text-success">45ms</strong>
                                                            </div>
                                                        </div>
                                                        <div class="progress mt-2" style="height: 5px;">
                                                            <div class="progress-bar bg-success" role="progressbar" style="width: 92%"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="p-3 border rounded bg-light">
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <div>
                                                                <h6 class="mb-1">数据同步状态</h6>
                                                                <span class="badge bg-info">同步中</span>
                                                            </div>
                                                            <div class="text-end">
                                                                <small class="d-block text-muted">最后更新</small>
                                                                <strong>2分钟前</strong>
                                                            </div>
                                                        </div>
                                                        <div class="progress mt-2" style="height: 5px;">
                                                            <div class="progress-bar bg-info" role="progressbar" style="width: 85%"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- API健康状态 -->
                                            <div class="mt-4">
                                                <h6 class="mb-3">API健康状态</h6>
                                                <canvas id="apiHealthChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                    
                                    <!-- 预警信息卡片 -->
                                    <div class="card custom-card mb-4">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">预警信息</h5>
                                            <span class="badge bg-danger">3 条未处理</span>
                                        </div>
                                        <div class="card-body p-0">
                                            <div class="timeline-vertical p-3">
                                                <div class="timeline-item">
                                                    <div class="timeline-marker bg-danger">
                                                        <i class="fas fa-exclamation-triangle"></i>
                                                    </div>
                                                    <div class="timeline-content">
                                                        <div class="d-flex justify-content-between">
                                                            <h6 class="text-danger mb-1">负荷超限预警</h6>
                                                    <small class="text-muted">10分钟前</small>
                                                </div>
                                                        <p class="mb-0">预计14:00负荷将超过安全阈值</p>
                                                        <div class="mt-2">
                                                            <button class="btn btn-sm btn-outline-danger me-2">立即处理</button>
                                                            <button class="btn btn-sm btn-light">忽略</button>
                                                    </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="timeline-item">
                                                    <div class="timeline-marker bg-warning">
                                                        <i class="fas fa-bolt"></i>
                                                    </div>
                                                    <div class="timeline-content">
                                                        <div class="d-flex justify-content-between">
                                                            <h6 class="text-warning mb-1">发电量异常</h6>
                                                    <small class="text-muted">25分钟前</small>
                                                </div>
                                                        <p class="mb-0">光伏发电量低于预期20%</p>
                                                        <div class="mt-2">
                                                            <button class="btn btn-sm btn-outline-warning me-2">查看详情</button>
                                                            <button class="btn btn-sm btn-light">忽略</button>
                                                    </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="timeline-item">
                                                    <div class="timeline-marker bg-warning">
                                                        <i class="fas fa-charging-station"></i>
                                                    </div>
                                                    <div class="timeline-content">
                                                        <div class="d-flex justify-content-between">
                                                            <h6 class="text-warning mb-1">充电站拥堵</h6>
                                                    <small class="text-muted">40分钟前</small>
                                                        </div>
                                                        <p class="mb-0">A区充电站使用率超过95%</p>
                                                        <div class="mt-2">
                                                            <button class="btn btn-sm btn-outline-warning me-2">查看详情</button>
                                                            <button class="btn btn-sm btn-light">忽略</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                    
                                    

                                    <!-- 决策历史记录模态框 -->
                                    <div class="modal fade" id="decisionHistoryModal" tabindex="-1">
                                        <div class="modal-dialog modal-lg">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">决策历史记录</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                                <div class="modal-body">
                                                    <div class="mb-3">
                                                        <div class="row g-2">
                                                            <div class="col-md-4">
                                                                <input type="text" class="form-control" id="historySearch" placeholder="搜索历史记录...">
                                                            </div>
                                                            <div class="col-md-3">
                                                                <select class="form-select" id="historyTypeFilter">
                                                                    <option value="">所有类型</option>
                                                                    <option value="energy">能源需求</option>
                                                                    <option value="production">生产优化</option>
                                                                    <option value="maintenance">设备维护</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <select class="form-select" id="historyStatusFilter">
                                                                    <option value="">所有状态</option>
                                                                    <option value="completed">已完成</option>
                                                                    <option value="cancelled">已取消</option>
                                                                    <option value="failed">执行失败</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <button class="btn btn-primary w-100" id="exportHistory">
                                                                    <i class="fas fa-download me-1"></i>导出
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="table-responsive">
                                                        <table class="table" id="historyTable">
                                                            <thead>
                                                                <tr>
                                                                    <th>执行时间</th>
                                                                    <th>决策类型</th>
                                                                    <th>决策内容</th>
                                                                    <th>实际收益</th>
                                                                    <th>执行结果</th>
                                                                    <th>操作</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="historyTableBody">
                                                                <!-- 历史记录将通过JavaScript动态生成 -->
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <div class="d-flex justify-content-between align-items-center mt-3">
                                                        <div class="text-muted">
                                                            共 <span id="totalHistory">0</span> 条记录
                                                        </div>
                                                        <nav>
                                                            <ul class="pagination pagination-sm mb-0" id="historyPagination">
                                                                <!-- 分页将通过JavaScript动态生成 -->
                                                            </ul>
                                                        </nav>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 建议详情模态框 -->
                                    <div class="modal fade" id="suggestionDetailModal" tabindex="-1">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">建议详情</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="suggestion-detail">
                                                        <!-- 详情内容将通过JavaScript动态生成 -->
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                                                    <button type="button" class="btn btn-primary" id="executeSuggestion">执行建议</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 执行确认模态框 -->
                                    <div class="modal fade" id="executeConfirmModal" tabindex="-1">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">执行确认</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <p>确定要执行该建议吗？执行后将无法撤销。</p>
                                                    <div class="alert alert-info">
                                                        <i class="fas fa-info-circle me-2"></i>
                                                        <span id="executeConfirmInfo"></span>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                                                    <button type="button" class="btn btn-primary" id="confirmExecute">确认执行</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        
                    </div>
                    <!-- container-fluid -->
                </div>
                <!-- End Page-content -->


                <footer class="footer">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-sm-6">
                                <script>document.write(new Date().getFullYear())</script> © 驭能能源管理系统.
                            </div>
                            <div class="col-sm-6">
                                <div class="text-sm-end d-none d-sm-block">
                                    <p class="mb-0">由 <i class="mdi mdi-heart text-danger"></i> 404REBORN 倾情打造 </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
            <!-- end main content-->

        </div>
        <!-- END layout-wrapper -->

        
        <!-- Right Sidebar -->
        <div class="right-bar">
            <div data-simplebar="" class="h-100">
                <div class="rightbar-title d-flex align-items-center bg-dark p-3">

                    <h5 class="m-0 me-2 text-white">Theme Customizer</h5>

                    <a href="javascript:void(0);" class="right-bar-toggle ms-auto">
                        <i class="mdi mdi-close noti-icon"></i>
                    </a>
                </div>

                <!-- Settings -->
                <hr class="m-0">

                <div class="p-4">
                    <h6 class="mb-3">Layout</h6>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="layout" id="layout-vertical" value="vertical">
                        <label class="form-check-label" for="layout-vertical">Vertical</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="layout" id="layout-horizontal" value="horizontal">
                        <label class="form-check-label" for="layout-horizontal">Horizontal</label>
                    </div>

                    <h6 class="mt-4 mb-3 pt-2">Layout Mode</h6>

                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="layout-mode" id="layout-mode-light" value="light">
                        <label class="form-check-label" for="layout-mode-light">Light</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="layout-mode" id="layout-mode-dark" value="dark">
                        <label class="form-check-label" for="layout-mode-dark">Dark</label>
                    </div>

                    <h6 class="mt-4 mb-3 pt-2">Layout Width</h6>

                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="layout-width" id="layout-width-fuild" value="fuild" onchange="document.body.setAttribute('data-layout-size', 'fluid')">
                        <label class="form-check-label" for="layout-width-fuild">Fluid</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="layout-width" id="layout-width-boxed" value="boxed" onchange="document.body.setAttribute('data-layout-size', 'boxed')">
                        <label class="form-check-label" for="layout-width-boxed">Boxed</label>
                    </div>

                    <h6 class="mt-4 mb-3 pt-2">Layout Position</h6>

                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="layout-position" id="layout-position-fixed" value="fixed" onchange="document.body.setAttribute('data-layout-scrollable', 'false')">
                        <label class="form-check-label" for="layout-position-fixed">Fixed</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="layout-position" id="layout-position-scrollable" value="scrollable" onchange="document.body.setAttribute('data-layout-scrollable', 'true')">
                        <label class="form-check-label" for="layout-position-scrollable">Scrollable</label>
                    </div>

                    <h6 class="mt-4 mb-3 pt-2">Topbar Color</h6>

                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="topbar-color" id="topbar-color-light" value="light" onchange="document.body.setAttribute('data-topbar', 'light')">
                        <label class="form-check-label" for="topbar-color-light">Light</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="topbar-color" id="topbar-color-dark" value="dark" onchange="document.body.setAttribute('data-topbar', 'dark')">
                        <label class="form-check-label" for="topbar-color-dark">Dark</label>
                    </div>

                    <h6 class="mt-4 mb-3 pt-2 sidebar-setting">Sidebar Size</h6>

                    <div class="form-check sidebar-setting">
                        <input class="form-check-input" type="radio" name="sidebar-size" id="sidebar-size-default" value="default" onchange="document.body.setAttribute('data-sidebar-size', 'lg')">
                        <label class="form-check-label" for="sidebar-size-default">Default</label>
                    </div>
                    <div class="form-check sidebar-setting">
                        <input class="form-check-input" type="radio" name="sidebar-size" id="sidebar-size-compact" value="compact" onchange="document.body.setAttribute('data-sidebar-size', 'md')">
                        <label class="form-check-label" for="sidebar-size-compact">Compact</label>
                    </div>
                    <div class="form-check sidebar-setting">
                        <input class="form-check-input" type="radio" name="sidebar-size" id="sidebar-size-small" value="small" onchange="document.body.setAttribute('data-sidebar-size', 'sm')">
                        <label class="form-check-label" for="sidebar-size-small">Small (Icon View)</label>
                    </div>

                    <h6 class="mt-4 mb-3 pt-2 sidebar-setting">Sidebar Color</h6>

                    <div class="form-check sidebar-setting">
                        <input class="form-check-input" type="radio" name="sidebar-color" id="sidebar-color-light" value="light" onchange="document.body.setAttribute('data-sidebar', 'light')">
                        <label class="form-check-label" for="sidebar-color-light">Light</label>
                    </div>
                    <div class="form-check sidebar-setting">
                        <input class="form-check-input" type="radio" name="sidebar-color" id="sidebar-color-dark" value="dark" onchange="document.body.setAttribute('data-sidebar', 'dark')">
                        <label class="form-check-label" for="sidebar-color-dark">Dark</label>
                    </div>
                    <div class="form-check sidebar-setting">
                        <input class="form-check-input" type="radio" name="sidebar-color" id="sidebar-color-brand" value="brand" onchange="document.body.setAttribute('data-sidebar', 'brand')">
                        <label class="form-check-label" for="sidebar-color-brand">Brand</label>
                    </div>

                    <h6 class="mt-4 mb-3 pt-2">Direction</h6>

                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="layout-direction" id="layout-direction-ltr" value="ltr">
                        <label class="form-check-label" for="layout-direction-ltr">LTR</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="layout-direction" id="layout-direction-rtl" value="rtl">
                        <label class="form-check-label" for="layout-direction-rtl">RTL</label>
                    </div>

                    <!-- 添加主题切换控制 -->
                    <div class="theme-settings">
                        <div class="theme-colors">
                            <h6>主题颜色</h6>
                            <div class="color-options">
                                <button class="color-option" data-theme="default"></button>
                                <button class="color-option" data-theme="dark"></button>
                                <button class="color-option" data-theme="blue"></button>
                                <button class="color-option" data-theme="green"></button>
                            </div>
                        </div>
                        <div class="theme-fonts">
                            <h6>字体设置</h6>
                            <select class="form-select form-select-sm">
                                <option value="default">默认字体</option>
                                <option value="microsoft">微软雅黑</option>
                                <option value="pingfang">苹方</option>
                            </select>
                        </div>
                    </div>
                </div>

            </div> <!-- end slimscroll-menu-->
        </div>
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>

        <!-- JAVASCRIPT -->
        <script src="static/js/jquery.min.js"></script>
        <script src="static/js/bootstrap.bundle.min.js"></script>
        <script src="static/js/metisMenu.min.js"></script>
        <script src="static/js/simplebar.min.js"></script>
        <script src="static/js/waves.min.js"></script>
        <script src="static/js/feather.min.js"></script>
        <!-- pace js -->
        <script src="static/js/pace.min.js"></script>

        <!-- apexcharts -->
        <script src="static/js/apexcharts.min.js"></script>

        <!-- Plugins js-->
        <script src="static/js/jquery-jvectormap-1.2.2.min.js"></script>
        <script src="static/js/jquery-jvectormap-world-mill-en.js"></script>
        <!-- dashboard init -->
        <script src="static/js/dashboard.init.js"></script>

        <script src="static/js/app.js"></script>

    </body>





    <!-- 脚本引入 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script>
    // 图表配置
    const chartConfig = {
        chart: {
            height: 280, // 统一图表高度
            type: 'line',
            toolbar: {
                show: false
            }
        },
        yaxis: {
            min: 0, // 统一Y轴起点
            max: function(max) { // 动态计算最大值，但保持一定留白
                return Math.ceil(max * 1.2);
            },
            tickAmount: 6, // 统一刻度数量
            labels: {
                formatter: function(value) {
                    return value.toFixed(0);
                }
            }
        },
        // ... 其他配置保持不变
    };

    // 应用配置到所有图表
    const charts = document.querySelectorAll('.prediction-chart');
    charts.forEach(chart => {
        new ApexCharts(chart, chartConfig).render();
    });

    // 图表配置和初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 通用图表配置
            const commonOptions = {
                responsive: true,
            maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    legend: {
                        position: 'top',
                    labels: {
                        usePointStyle: true,
                        padding: 15,
                        font: {
                            size: 12
                        }
                    }
                    },
                    tooltip: {
                        mode: 'index',
                    intersect: false,
                    backgroundColor: 'rgba(255, 255, 255, 0.9)',
                    titleColor: '#000',
                    bodyColor: '#666',
                    borderColor: '#ddd',
                    borderWidth: 1,
                    padding: 10,
                    boxPadding: 5,
                    usePointStyle: true,
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            label += context.parsed.y + ' MW';
                            return label;
                        }
                    }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: {
                        drawBorder: false,
                        color: 'rgba(0, 0, 0, 0.05)'
                    },
                    ticks: {
                        font: {
                            size: 11
                        }
                        }
                    },
                    x: {
                        grid: {
                            display: false
                    },
                    ticks: {
                        font: {
                            size: 11
                        }
                        }
                    }
                }
            };

            // 发电预测图表
            const powerCtx = document.getElementById('powerPredictionChart').getContext('2d');
            const powerChart = new Chart(powerCtx, {
                type: 'line',
                data: {
                    labels: ['06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00'],
                    datasets: [{
                        label: '光伏发电预测',
                        data: [50, 120, 180, 200, 190, 160, 100, 40],
                        borderColor: '#ffc107',
                    backgroundColor: 'rgba(255, 193, 7, 0.2)',
                    borderWidth: 2,
                        tension: 0.4,
                    fill: true,
                    pointStyle: 'circle',
                    pointRadius: 4,
                    pointHoverRadius: 6
                    }, {
                        label: '风电预测',
                        data: [80, 95, 110, 100, 85, 95, 120, 110],
                        borderColor: '#20c997',
                    backgroundColor: 'rgba(32, 201, 151, 0.2)',
                    borderWidth: 2,
                        tension: 0.4,
                    fill: true,
                    pointStyle: 'circle',
                    pointRadius: 4,
                    pointHoverRadius: 6
                    }, {
                        label: '实际发电量',
                        data: [75, 110, 170, 185, 175, 150, 95, null],
                        borderColor: '#dc3545',
                        borderDash: [5, 5],
                    borderWidth: 2,
                        tension: 0.4,
                    fill: false,
                    pointStyle: 'circle',
                    pointRadius: 4,
                    pointHoverRadius: 6
                    }]
                },
                options: {
                    ...commonOptions,
                    plugins: {
                        ...commonOptions.plugins,
                        title: {
                        display: false
                        }
                    }
                }
            });

            // 负荷预测图表
            const loadCtx = document.getElementById('loadPredictionChart').getContext('2d');
            const loadChart = new Chart(loadCtx, {
                type: 'line',
                data: {
                    labels: ['06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00'],
                    datasets: [{
                        label: '负荷预测',
                    data: [150, 180, 220, 240, 260, 250, 220, 180],
                    borderColor: '#0dcaf0',
                    backgroundColor: 'rgba(13, 202, 240, 0.2)',
                    borderWidth: 2,
                        tension: 0.4,
                    fill: true,
                    pointStyle: 'circle',
                    pointRadius: 4,
                    pointHoverRadius: 6
                    }, {
                        label: '实际负荷',
                    data: [155, 175, 215, 235, 255, null, null, null],
                    borderColor: '#dc3545',
                        borderDash: [5, 5],
                    borderWidth: 2,
                        tension: 0.4,
                    fill: false,
                    pointStyle: 'circle',
                    pointRadius: 4,
                    pointHoverRadius: 6
                }, {
                    label: '安全阈值',
                    data: [280, 280, 280, 280, 280, 280, 280, 280],
                    borderColor: '#ffc107',
                    borderWidth: 2,
                    borderDash: [2, 2],
                    tension: 0,
                    fill: false,
                    pointStyle: 'line'
                    }]
                },
                options: {
                    ...commonOptions,
                    plugins: {
                        ...commonOptions.plugins,
                        title: {
                        display: false
                    }
                },
                scales: {
                    ...commonOptions.scales,
                    y: {
                        ...commonOptions.scales.y,
                        suggestedMax: 300
                        }
                    }
                }
            });

            // 电价预测图表
            const priceCtx = document.getElementById('pricePredictionChart').getContext('2d');
            const priceChart = new Chart(priceCtx, {
                type: 'line',
                data: {
                    labels: ['06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00'],
                    datasets: [{
                        label: '电价预测',
                    data: [0.45, 0.52, 0.68, 0.75, 0.82, 0.78, 0.65, 0.55],
                    borderColor: '#198754',
                    backgroundColor: 'rgba(25, 135, 84, 0.2)',
                    borderWidth: 2,
                        tension: 0.4,
                    fill: true,
                    pointStyle: 'circle',
                    pointRadius: 4,
                    pointHoverRadius: 6
                    }, {
                        label: '实际电价',
                        data: [0.46, 0.54, 0.65, 0.72, 0.80, null, null, null],
                    borderColor: '#dc3545',
                        borderDash: [5, 5],
                    borderWidth: 2,
                        tension: 0.4,
                    fill: false,
                    pointStyle: 'circle',
                    pointRadius: 4,
                    pointHoverRadius: 6
                }, {
                    label: '基准电价',
                    data: [0.60, 0.60, 0.60, 0.60, 0.60, 0.60, 0.60, 0.60],
                    borderColor: '#6c757d',
                    borderWidth: 2,
                    borderDash: [2, 2],
                    tension: 0,
                    fill: false,
                    pointStyle: 'line'
                    }]
                },
                options: {
                    ...commonOptions,
                    plugins: {
                        ...commonOptions.plugins,
                        title: {
                        display: false
                    },
                    tooltip: {
                        ...commonOptions.plugins.tooltip,
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += context.parsed.y + ' ¥/kWh';
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    ...commonOptions.scales,
                    y: {
                        ...commonOptions.scales.y,
                        ticks: {
                            callback: function(value) {
                                return value.toFixed(2) + ' ¥';
                            }
                        }
                        }
                    }
                }
            });

            // 充电预测图表
            const chargingCtx = document.getElementById('chargingPredictionChart').getContext('2d');
            const chargingChart = new Chart(chargingCtx, {
            type: 'line',
                data: {
                    labels: ['06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00'],
                    datasets: [{
                        label: '充电需求预测',
                    data: [30, 45, 65, 85, 95, 90, 75, 50],
                    borderColor: '#fd7e14',
                    backgroundColor: 'rgba(253, 126, 20, 0.2)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true,
                    pointStyle: 'circle',
                    pointRadius: 4,
                    pointHoverRadius: 6
                }, {
                    label: '实际充电需求',
                    data: [32, 48, 62, 88, 92, null, null, null],
                    borderColor: '#dc3545',
                    borderDash: [5, 5],
                    borderWidth: 2,
                    tension: 0.4,
                    fill: false,
                    pointStyle: 'circle',
                    pointRadius: 4,
                    pointHoverRadius: 6
                }, {
                    label: '充电站容量',
                    data: [100, 100, 100, 100, 100, 100, 100, 100],
                    borderColor: '#6c757d',
                    borderWidth: 2,
                    borderDash: [2, 2],
                    tension: 0,
                    fill: false,
                    pointStyle: 'line'
                    }]
                },
                options: {
                    ...commonOptions,
                    plugins: {
                        ...commonOptions.plugins,
                    title: {
                        display: false
                    },
                    tooltip: {
                        ...commonOptions.plugins.tooltip,
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += context.parsed.y + ' kW';
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    ...commonOptions.scales,
                    y: {
                        ...commonOptions.scales.y,
                        suggestedMax: 120,
                        ticks: {
                            callback: function(value) {
                                return value + ' kW';
                            }
                        }
                    }
                }
            }
        });

        // 初始化30天预测准确率图表
        const accuracyCtx = document.getElementById('accuracyChart').getContext('2d');
        const accuracyChart = new Chart(accuracyCtx, {
            type: 'line',
            data: {
                labels: Array.from({length: 30}, (_, i) => `${i + 1}日`),
                datasets: [{
                    label: '发电预测准确率',
                    data: generateRandomAccuracy(30),
                    borderColor: '#ffc107',
                    tension: 0.4
                }, {
                    label: '负荷预测准确率',
                    data: generateRandomAccuracy(30),
                    borderColor: '#0d6efd',
                    tension: 0.4
                }, {
                    label: '充电预测准确率',
                    data: generateRandomAccuracy(30),
                    borderColor: '#198754',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                        title: {
                            display: true,
                        text: '预测准确率趋势(MAPE)'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: {
                            display: true,
                            text: '准确率(%)'
                        }
                        }
                    }
                }
            });

        function generateRandomAccuracy(count) {
            return Array.from({length: count}, () => 85 + Math.random() * 10);
        }

        // 增强的拖拽功能实现
        document.addEventListener('DOMContentLoaded', function() {
            const draggableItems = document.querySelectorAll('.resource-item');
            const scheduleGrid = document.getElementById('scheduleGrid');
            let activeItem = null;

            // 初始化拖拽事件
            draggableItems.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
            });

            scheduleGrid.addEventListener('dragover', handleDragOver);
            scheduleGrid.addEventListener('drop', handleDrop);
            scheduleGrid.addEventListener('click', handleGridClick);

            function handleDragStart(e) {
                this.classList.add('dragging');
                e.dataTransfer.setData('application/json', JSON.stringify({
                    type: this.dataset.type,
                    capacity: this.dataset.capacity
                }));
                activeItem = this;
            }

            function handleDragEnd(e) {
                this.classList.remove('dragging');
                activeItem = null;
            }

            function handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
            }

            function handleDrop(e) {
                e.preventDefault();
                const data = JSON.parse(e.dataTransfer.getData('application/json'));
                const rect = this.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                createScheduleItem(data, x, y);
            }

            function createScheduleItem(data, x, y) {
                const scheduleItem = document.createElement('div');
                scheduleItem.className = 'schedule-item';
                scheduleItem.draggable = true;
                scheduleItem.dataset.type = data.type;
                scheduleItem.dataset.capacity = data.capacity;
                
                // 计算时间点
                const timePercentage = (x / scheduleGrid.offsetWidth * 24).toFixed(1);
                const capacityValue = parseInt(data.capacity);
                
                scheduleItem.innerHTML = `
                    <div class="d-flex align-items-center">
                        <i class="fas fa-${getIconForType(data.type)} me-2"></i>
                        <span>${getNameForType(data.type)}</span>
                        <span class="badge bg-light text-dark ms-2">${capacityValue}MW</span>
                    </div>
                    <small>${timePercentage}:00</small>
                `;
                
                scheduleItem.style.left = `${x}px`;
                scheduleItem.style.top = `${y}px`;
                
                // 添加删除按钮
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-sm btn-danger position-absolute top-0 end-0';
                deleteBtn.innerHTML = '<i class="fas fa-times"></i>';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    scheduleItem.remove();
                };
                
                scheduleItem.appendChild(deleteBtn);
                scheduleGrid.appendChild(scheduleItem);
                
                // 使新创建的项也可拖动
                scheduleItem.addEventListener('dragstart', handleScheduleItemDragStart);
                scheduleItem.addEventListener('dragend', handleScheduleItemDragEnd);
            }

            function handleScheduleItemDragStart(e) {
                this.classList.add('dragging');
                e.dataTransfer.setData('application/json', JSON.stringify({
                    type: this.dataset.type,
                    capacity: this.dataset.capacity
                }));
            }

            function handleScheduleItemDragEnd(e) {
                this.classList.remove('dragging');
            }

            function getIconForType(type) {
                const icons = {
                    solar: 'solar-panel',
                    wind: 'fan',
                    thermal: 'industry',
                    battery: 'battery-full',
                    pump: 'water',
                    industrial: 'industry',
                    commercial: 'building'
                };
                return icons[type] || 'question';
            }

            function getNameForType(type) {
                const names = {
                    solar: '光伏发电',
                    wind: '风力发电',
                    thermal: '火力发电',
                    battery: '储能电站',
                    pump: '抽水蓄能',
                    industrial: '工业用户',
                    commercial: '商业用户'
                };
                return names[type] || '未知资源';
            }

            // 保存方案
            document.getElementById('saveSchedule').addEventListener('click', function() {
                const scheduleItems = document.querySelectorAll('.schedule-item');
                const scheduleData = Array.from(scheduleItems).map(item => ({
                    type: item.dataset.type,
                    capacity: item.dataset.capacity,
                    position: {
                        x: item.style.left,
                        y: item.style.top
                    },
                    time: calculateTime(parseInt(item.style.left))
                }));
                
                // 保存到localStorage
                localStorage.setItem('savedSchedule', JSON.stringify(scheduleData));
                
                // 显示成功提示
                showToast('调度方案已保存');
            });

            // 提交调度指令
            document.getElementById('submitSchedule').addEventListener('click', function() {
                const scheduleItems = document.querySelectorAll('.schedule-item');
                const scheduleData = Array.from(scheduleItems).map(item => ({
                    type: item.dataset.type,
                    capacity: item.dataset.capacity,
                    time: calculateTime(parseInt(item.style.left))
                }));
                
                // TODO: 发送到后端
                console.log('调度指令:', scheduleData);
                showToast('调度指令已下发');
            });

            function calculateTime(x) {
                const hour = (x / scheduleGrid.offsetWidth * 24).toFixed(1);
                return `${hour}:00`;
            }

            function showToast(message) {
                // 创建toast提示
                const toast = document.createElement('div');
                toast.className = 'toast position-fixed bottom-0 end-0 m-3';
                toast.setAttribute('role', 'alert');
                toast.innerHTML = `
                    <div class="toast-header">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong class="me-auto">系统提示</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">${message}</div>
                `;
                
                document.body.appendChild(toast);
                const bsToast = new bootstrap.Toast(toast);
                bsToast.show();
                
                // 自动移除
                toast.addEventListener('hidden.bs.toast', () => {
                    document.body.removeChild(toast);
                });
            }
        });
        });

        document.querySelectorAll('.detail-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const chartType = this.dataset.chart;
                // 根据图表类型跳转不同页面
                const routes = {
                    power: 'app-power_generation_index.html',
                    load: '/analysis/load-detail',
                    price: '/market/price-detail',
                    charging: '/energy/charging-detail'
                };
                window.location.href = routes[chartType];
            });
        });

        async function handleExportReport() {
            try {
                // 生成报告内容
                const reportContent = generateReport();
                
                // 创建临时容器并添加报告内容
                const tempDiv = document.createElement('div');
                tempDiv.className = 'report-content';
                tempDiv.innerHTML = marked.parse(reportContent);
                
                document.body.appendChild(tempDiv);
                
                // 配置PDF导出选项
                const opt = {
                    margin: [15, 15],
                    filename: `能源预测分析报告_${new Date().toISOString().split('T')[0]}.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };
                
                // 生成PDF
                await html2pdf().set(opt).from(tempDiv).save();
                
                // 清理临时元素
                document.body.removeChild(tempDiv);
                
                // 显示成功提示
                Swal.fire({
                    title: '导出成功',
                    text: '报告已成功生成',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });
            } catch (error) {
                console.error('PDF生成错误:', error);
                Swal.fire({
                    title: '导出失败',
                    text: '生成报告时发生错误',
                    icon: 'error'
                });
            }
        }

        function generateReport() {
            const now = new Date();
            const reportDate = now.toLocaleString('zh-CN', { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // 获取当前数据
            const currentData = {
                totalPower: '2,856.4',
                solarPower: '1,654.2',
                windPower: '1,202.2',
                carbonReduction: '1,523',
                solarAccuracy: '95.2',
                windAccuracy: '93.8',
                predictions: {
                    solar: [
                        { time: '10:00', predicted: '180.5', actual: '175.2', error: '2.91' },
                        { time: '12:00', predicted: '210.3', actual: '205.8', error: '2.14' },
                        { time: '14:00', predicted: '195.7', actual: '190.2', error: '2.81' }
                    ],
                    wind: [
                        { time: '10:00', predicted: '120.2', actual: '118.5', error: '1.41' },
                        { time: '12:00', predicted: '135.6', actual: '130.2', error: '3.98' },
                        { time: '14:00', predicted: '128.4', actual: '125.7', error: '2.10' }
                    ]
                },
                alerts: [
                    { level: '紧急', content: '成都光伏电站功率在10分钟内下降40%，疑似设备故障' },
                    { level: '警告', content: '甘孜风电基地3#、5#风机偏航角度异常' }
                ],
                suggestions: [
                    { type: '紧急', content: '立即启动成都光伏电站备用逆变器阵列，预计可恢复50MW发电能力' },
                    { type: '优化', content: '根据气象预报，建议调整光伏板角度至32°，预计可提升发电效率8%' },
                    { type: '维护', content: '建议对甘孜风电基地3#、5#风机进行偏航系统检修' }
                ]
            };

            return `# 综合能源预测分析报告
生成时间: ${reportDate}

## 1. 关键指标概览
| 指标 | 数值 | 说明 |
|------|------|------|
| 总发电量 | ${currentData.totalPower} MWh | 当日累计发电量 |
| 光伏发电量 | ${currentData.solarPower} MWh | 占比 58% |
| 风电发电量 | ${currentData.windPower} MWh | 占比 42% |
| 碳减排量 | ${currentData.carbonReduction} 吨 | 相当于植树 7,615 棵 |

## 2. 预测准确性分析
### 2.1 光伏发电预测
- 整体准确率: ${currentData.solarAccuracy}%
- 最近3小时预测数据:

| 时间 | 预测值(MW) | 实际值(MW) | 误差率(%) |
|------|------------|------------|-----------|
${currentData.predictions.solar.map(p => `| ${p.time} | ${p.predicted} | ${p.actual} | ${p.error} |`).join('\n')}

### 2.2 风力发电预测
- 整体准确率: ${currentData.windAccuracy}%
- 最近3小时预测数据:

| 时间 | 预测值(MW) | 实际值(MW) | 误差率(%) |
|------|------------|------------|-----------|
${currentData.predictions.wind.map(p => `| ${p.time} | ${p.predicted} | ${p.actual} | ${p.error} |`).join('\n')}

## 3. 预警信息
${currentData.alerts.map(alert => `### ${alert.level}预警
- ${alert.content}`).join('\n\n')}

## 4. 决策建议
${currentData.suggestions.map(s => `### ${s.type}建议
- ${s.content}`).join('\n\n')}

## 5. 结论
1. 发电预测模型表现稳定，光伏发电预测准确率${currentData.solarAccuracy}%，风电预测准确率${currentData.windAccuracy}%
2. 当前存在2项需要关注的预警事项，建议及时处理成都光伏电站功率骤降问题
3. 建议按照优先级执行以上决策建议，预计可提升整体发电效率约8%

---
注：本报告由系统自动生成，数据截至 ${reportDate}`;
        }

    // 决策建议优先级饼图
    const suggestionsPriorityCtx = document.getElementById('suggestionsPriorityChart').getContext('2d');
    new Chart(suggestionsPriorityCtx, {
        type: 'doughnut',
        data: {
            labels: ['紧急', '重要', '普通'],
            datasets: [{
                data: [3, 5, 2],
                backgroundColor: [
                    'rgba(220, 53, 69, 0.8)',
                    'rgba(255, 193, 7, 0.8)',
                    'rgba(13, 202, 240, 0.8)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom'
                },
                title: {
                    display: true,
                    text: '建议优先级分布'
                }
            }
        }
    });

    // 决策建议类型柱状图
    const suggestionsTypeCtx = document.getElementById('suggestionsTypeChart').getContext('2d');
    new Chart(suggestionsTypeCtx, {
        type: 'bar',
        data: {
            labels: ['发电调度', '需求响应', '市场交易', '储能调度', '其他'],
            datasets: [{
                label: '建议数量',
                data: [4, 3, 2, 2, 1],
                backgroundColor: [
                    'rgba(13, 110, 253, 0.8)',
                    'rgba(25, 135, 84, 0.8)',
                    'rgba(13, 202, 240, 0.8)',
                    'rgba(102, 16, 242, 0.8)',
                    'rgba(108, 117, 125, 0.8)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                },
                title: {
                    display: true,
                    text: '建议类型分布'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            }
        }
    });

    // 初始化设备状态仪表盘
    function initDeviceGauges() {
        const gaugeOptions = {
            type: 'doughnut',
            options: {
                rotation: -90,
                circumference: 180,
                cutout: '80%',
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        };

        // 光伏设备仪表盘
        new Chart(document.getElementById('solarGauge').getContext('2d'), {
            ...gaugeOptions,
            data: {
                datasets: [{
                    data: [92, 8],
                    backgroundColor: ['#2ab57d', '#e9ecef']
                }]
            }
        });

        // 风机设备仪表盘
        new Chart(document.getElementById('windGauge').getContext('2d'), {
            ...gaugeOptions,
            data: {
                datasets: [{
                    data: [85, 15],
                    backgroundColor: ['#4F8CBE', '#e9ecef']
                }]
            }
        });

        // 储能设备仪表盘
        new Chart(document.getElementById('storageGauge').getContext('2d'), {
            ...gaugeOptions,
            data: {
                datasets: [{
                    data: [75, 25],
                    backgroundColor: ['#fd7e14', '#e9ecef']
                }]
            }
        });

        // 充电设施仪表盘
        new Chart(document.getElementById('chargingGauge').getContext('2d'), {
            ...gaugeOptions,
            data: {
                datasets: [{
                    data: [80, 20],
                    backgroundColor: ['#6f42c1', '#e9ecef']
                }]
            }
        });
    }

    // 初始化设备告警统计图表
    function initDeviceAlertChart() {
        new Chart(document.getElementById('deviceAlertChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: ['光伏设备', '风机设备', '储能设备', '充电设施'],
                datasets: [{
                    label: '正常',
                    data: [45, 32, 15, 28],
                    backgroundColor: '#2ab57d'
                }, {
                    label: '告警',
                    data: [2, 5, 1, 3],
                    backgroundColor: '#f46a6a'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: '设备告警统计'
                    },
                    legend: {
                        position: 'bottom'
                    }
                },
                scales: {
                    x: {
                        stacked: true
                    },
                    y: {
                        stacked: true,
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // 初始化系统性能指标图表
    function initSystemPerformanceChart() {
        new Chart(document.getElementById('systemPerformanceChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                datasets: [{
                    label: 'CPU使用率',
                    data: [45, 52, 38, 65, 42, 48],
                    borderColor: '#4F8CBE',
                    tension: 0.4
                }, {
                    label: '内存使用率',
                    data: [62, 58, 55, 70, 65, 60],
                    borderColor: '#2ab57d',
                    tension: 0.4
                }, {
                    label: '存储使用率',
                    data: [35, 38, 40, 42, 45, 48],
                    borderColor: '#fd7e14',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: '系统资源使用率'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: value => value + '%'
                        }
                    }
                }
            }
        });
    }

    // 初始化API健康状态图表
    function initApiHealthChart() {
        new Chart(document.getElementById('apiHealthChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                datasets: [{
                    label: '响应时间',
                    data: generateRandomResponseTimes(24),
                    borderColor: '#4F8CBE',
                    tension: 0.4,
                    fill: true,
                    backgroundColor: 'rgba(79, 140, 190, 0.1)'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'API响应时间趋势'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: value => value + 'ms'
                        }
                    }
                }
            }
        });
    }

    // 生成随机响应时间数据
    function generateRandomResponseTimes(count) {
        return Array.from({length: count}, () => Math.floor(30 + Math.random() * 50));
    }

    // 页面加载完成后初始化所有图表
    document.addEventListener('DOMContentLoaded', function() {
        initDeviceGauges();
        initDeviceAlertChart();
        initSystemPerformanceChart();
        initApiHealthChart();
    });

    // 刷新设备状态
    function refreshDeviceStatus() {
        // TODO: 实现实时数据刷新逻辑
        showToast('设备状态已更新');
    }

    // 添加全局错误处理
    window.onerror = function(message, source, lineno, colno, error) {
        // 记录错误日志
        console.error({
            message,
            source,
            lineno,
            colno,
            error,
            timestamp: new Date().toISOString()
        });
        
        // 显示用户友好的错误提示
        showErrorNotification('系统遇到了一些问题，请稍后重试');
        
        return false;
    };

    // 添加API请求错误处理
    async function fetchData(url, options = {}) {
        try {
            const response = await fetch(url, options);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return await response.json();
        } catch (error) {
            console.error('Data fetch error:', error);
            showErrorNotification('数据加载失败，请检查网络连接');
            throw error;
        }
        }
    </script>

    <!-- 添加实时通知组件 -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1050">
        <div id="notificationToast" class="toast" role="alert">
            <div class="toast-header">
                <i class="fas fa-bell me-2"></i>
                <strong class="me-auto">系统通知</strong>
                <small class="text-muted">刚刚</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">
                <!-- 动态内容将通过JavaScript插入 -->
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // 权限检查
        const userRole = getUserRole(); // 获取用户角色
        if (userRole !== 'admin') {
            disableDragDrop();
            showToast('权限不足，无法执行调度操作', 'warning');
            return;
        }

        // 初始化拖拽功能
        initDragDrop();
        
        // 初始化调度任务列表
        updateTaskList();
    });

    function initDragDrop() {
        const draggableItems = document.querySelectorAll('.resource-item[draggable="true"]');
        const dropZones = document.querySelectorAll('.droppable-zone');

        draggableItems.forEach(item => {
            item.addEventListener('dragstart', handleDragStart);
            item.addEventListener('dragend', handleDragEnd);
        });

        dropZones.forEach(zone => {
            zone.addEventListener('dragover', handleDragOver);
            zone.addEventListener('dragleave', handleDragLeave);
            zone.addEventListener('drop', handleDrop);
        });
    }

    function handleDragStart(e) {
        e.dataTransfer.setData('text/plain', JSON.stringify({
            type: this.dataset.type,
            value: this.querySelector('.badge').textContent
        }));
        this.classList.add('dragging');
    }

    function handleDragEnd(e) {
        this.classList.remove('dragging');
    }

    function handleDragOver(e) {
        e.preventDefault();
        this.classList.add('drag-over');
    }

    function handleDragLeave(e) {
        this.classList.remove('drag-over');
    }

    function handleDrop(e) {
        e.preventDefault();
        this.classList.remove('drag-over');

        const data = JSON.parse(e.dataTransfer.getData('text/plain'));
        
        // 显示阈值设置对话框
        showThresholdDialog(data, this.id)
            .then(threshold => {
                if (threshold) {
                    createScheduleTask(data, threshold, this.id);
                }
            })
            .catch(error => {
                showToast(error.message, 'error');
            });
    }

    function showThresholdDialog(data, targetZone) {
        return new Promise((resolve, reject) => {
            const dialog = new bootstrap.Modal(document.createElement('div'));
            dialog.element.innerHTML = `
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">设置调度阈值</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>阈值设置 (MW)</label>
                                <input type="number" class="form-control" id="thresholdInput" 
                                       min="0" step="0.1" required>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-primary" id="confirmThreshold">确定</button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(dialog.element);
            dialog.show();

            const input = dialog.element.querySelector('#thresholdInput');
            const confirmBtn = dialog.element.querySelector('#confirmThreshold');

            confirmBtn.onclick = () => {
                const value = input.value;
                if (!value || isNaN(value)) {
                    reject(new Error('阈值必须为数字，请重新输入'));
                    return;
                }
                resolve(parseFloat(value));
                dialog.hide();
            };

            dialog.element.addEventListener('hidden.bs.modal', () => {
                document.body.removeChild(dialog.element);
            });
        });
    }

    function createScheduleTask(data, threshold, targetZone) {
        const task = {
            id: generateTaskId(),
            type: data.type,
            threshold: threshold,
            target: targetZone,
            status: 'pending',
            progress: 0,
            startTime: new Date()
        };

        // 添加到任务列表
        addTaskToList(task);
        
        // 在时间轴上显示任务
        addTaskToTimeline(task);
    }

    function addTaskToList(task) {
        const taskList = document.getElementById('taskList');
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${getTaskTargetName(task.target)}</td>
            <td>${getTaskTypeName(task.type)}</td>
            <td>${task.threshold} MW</td>
            <td>${formatDateTime(task.startTime)}</td>
            <td>
                <div class="progress" style="height: 5px;">
                    <div class="progress-bar" role="progressbar" style="width: ${task.progress}%"></div>
                </div>
            </td>
            <td><span class="badge bg-warning">待执行</span></td>
            <td>
                <button class="btn btn-sm btn-primary" onclick="executeTask('${task.id}')">
                    执行
                </button>
                <button class="btn btn-sm btn-danger" onclick="cancelTask('${task.id}')">
                    取消
                </button>
            </td>
        `;
        taskList.appendChild(row);
    }

    function executeTask(taskId) {
        // 模拟任务执行
        updateTaskStatus(taskId, 'running');
        simulateTaskProgress(taskId);
    }

    function simulateTaskProgress(taskId) {
        let progress = 0;
        const interval = setInterval(() => {
            progress += 10;
            updateTaskProgress(taskId, progress);
            
            if (progress >= 100) {
                clearInterval(interval);
                updateTaskStatus(taskId, 'completed');
            }
        }, 1000);
    }

    // 辅助函数
    function showToast(message, type = 'info') {
        // 实现提示信息显示
    }

    function updateTaskStatus(taskId, status) {
        // 更新任务状态
    }

    function updateTaskProgress(taskId, progress) {
        // 更新任务进度
    }

    function disableDragDrop() {
        // 禁用拖拽功能
        }
    </script>

    <!-- 在已有HTML代码后添加以下JavaScript代码 -->
    <script>
    $(document).ready(function() {
        // 预测详情数据模块
        const PredictionDetails = {
            // 状态变量
            state: {
                currentPage: 1,
                pageSize: 10,
                totalRecords: 0,
                data: [], // 存储当前页数据
                filters: {} // 存储筛选条件
            },

            // 初始化
            init: function() {
                this.initTableData();
                this.initPagination();
                this.initFilters();
                this.initExport();
                this.initTableEditable();
            },

            // 初始化表格数据
            initTableData: function() {
                // 模拟初始数据
                this.state.data = this.generateMockData(50); // 生成50条模拟数据
                this.state.totalRecords = this.state.data.length;
                this.renderTable();
                this.updatePagination();
            },

            // 生成模拟数据
            generateMockData: function(count) {
                const data = [];
                const types = ['发电预测', '负荷预测', '电价预测'];
                const models = ['Predenergy', 'GRU-B', 'XGBoost-C'];
                
                for (let i = 0; i < count; i++) {
                    const type = types[i % 3];
                    const isPrice = type === '电价预测';
                    const predicted = isPrice ? (Math.random() * 0.5 + 0.5).toFixed(2) : 
                                             (Math.random() * 200 + 150).toFixed(1);
                    const variance = Math.random() * 0.2 - 0.1; // -10% to +10%
                    const actual = isPrice ? 
                        (predicted * (1 + variance)).toFixed(2) : 
                        (predicted * (1 + variance)).toFixed(1);
                    const error = Math.abs(((predicted - actual) / actual) * 100).toFixed(2);
                    
                    data.push({
                        time: new Date(2024, 2, 21, 8 + Math.floor(i / 3)).toLocaleString('zh-CN', {
                            hour12: false,
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        }),
                        type: type,
                        predicted: predicted + (isPrice ? ' ¥/kWh' : ' MW'),
                        actual: actual + (isPrice ? ' ¥/kWh' : ' MW'),
                        error: error,
                        confidence: (95 - error * 2).toFixed(0),
                        model: models[i % 3],
                        status: error <= 5 ? 'success' : error <= 10 ? 'warning' : 'danger'
                    });
                }
                return data;
            },

            // 渲染表格
            renderTable: function() {
                const startIdx = (this.state.currentPage - 1) * this.state.pageSize;
                const endIdx = Math.min(startIdx + this.state.pageSize, this.state.totalRecords);
                const pageData = this.state.data.slice(startIdx, endIdx);
                
                const tbody = $('.table-editable tbody');
                tbody.empty();
                
                pageData.forEach(item => {
                    tbody.append(`
                        <tr>
                            <td>${item.time}</td>
                            <td>${item.type}</td>
                            <td data-field="predicted">${item.predicted}</td>
                            <td data-field="actual">${item.actual}</td>
                            <td>${item.error}%</td>
                            <td>${item.confidence}%</td>
                            <td>${item.model}</td>
                            <td><span class="badge bg-${item.status}">${
                                item.status === 'success' ? '正常' : 
                                item.status === 'warning' ? '警告' : '错误'
                            }</span></td>
                            <td>
                                <a class="btn btn-outline-secondary btn-sm edit" title="编辑">
                                    <i class="fas fa-pencil-alt"></i>
                                </a>
                            </td>
                        </tr>
                    `);
                });
            },

            // 更新分页控件
            updatePagination: function() {
                const totalPages = Math.ceil(this.state.totalRecords / this.state.pageSize);
                const $pagination = $('.pagination');
                const $info = $('.dataTables_info');
                
                // 清除现有页码按钮
                $pagination.find('.page-item:not(.previous):not(.next)').remove();
                
                // 生成页码按钮
                for (let i = 1; i <= totalPages; i++) {
                    const isActive = i === this.state.currentPage;
                    const $pageItem = $(`
                        <li class="paginate_button page-item ${isActive ? 'active' : ''}">
                            <a href="#" class="page-link" data-page="${i}">${i}</a>
                        </li>
                    `);
                    $pagination.find('.next').before($pageItem);
                }
                
                // 更新前后按钮状态
                $pagination.find('.previous').toggleClass('disabled', this.state.currentPage === 1);
                $pagination.find('.next').toggleClass('disabled', this.state.currentPage === totalPages);
                
                // 更新信息显示
                const startRecord = (this.state.currentPage - 1) * this.state.pageSize + 1;
                const endRecord = Math.min(this.state.currentPage * this.state.pageSize, this.state.totalRecords);
                $info.text(`显示 ${startRecord} 到 ${endRecord}，共 ${this.state.totalRecords} 条记录`);
            },

            // 初始化分页事件
            initPagination: function() {
                const self = this;
                
                // 解绑之前的事件处理器
                $('.pagination').off('click', '.page-link');
                
                // 绑定新的事件处理器
                $('.pagination').on('click', '.page-link', function(e) {
                    e.preventDefault();
                    const $btn = $(this);
                    const $item = $btn.parent();
                    
                    if ($item.hasClass('disabled')) return;
                    
                    if ($item.hasClass('previous')) {
                        self.state.currentPage--;
                    } else if ($item.hasClass('next')) {
                        self.state.currentPage++;
                    } else {
                        self.state.currentPage = parseInt($btn.data('page'));
                    }
                    
                    self.renderTable();
                    self.updatePagination();
                });
            },

            // 初始化筛选功能
            initFilters: function() {
                const self = this;
                
                // 重置按钮
                $('#filterPanel .btn-light').click(function() {
                    $('#filterPanel select').val('');
                    $('#filterPanel input').val('');
                    self.state.filters = {};
                    self.state.currentPage = 1;
                    self.filterData();
                });
                
                // 应用筛选
                $('#filterPanel .btn-primary').click(function() {
                    self.state.filters = {
                        types: $('#filterPanel select[multiple]').val(),
                        errorRange: {
                            min: $('#filterPanel input[placeholder="最小值"]').val(),
                            max: $('#filterPanel input[placeholder="最大值"]').val()
                        },
                        timeRange: $('#filterPanel input[type="datetime-local"]').val(),
                        status: $('#filterPanel select:not([multiple])').val()
                    };
                    self.state.currentPage = 1;
                    self.filterData();
                });
            },

            // 筛选数据
            filterData: function() {
                let filteredData = this.state.data;
                const filters = this.state.filters;
                
                if (filters.types && filters.types.length) {
                    filteredData = filteredData.filter(item => 
                        filters.types.includes(item.type === '发电预测' ? 'power' : 
                                            item.type === '负荷预测' ? 'load' : 'price')
                    );
                }
                
                if (filters.errorRange.min || filters.errorRange.max) {
                    filteredData = filteredData.filter(item => {
                        const error = parseFloat(item.error);
                        return (!filters.errorRange.min || error >= filters.errorRange.min) &&
                               (!filters.errorRange.max || error <= filters.errorRange.max);
                    });
                }
                
                if (filters.status) {
                    filteredData = filteredData.filter(item => {
                        const status = item.status === 'success' ? 'normal' :
                                     item.status === 'warning' ? 'warning' : 'error';
                        return status === filters.status;
                    });
                }
                
                this.state.data = filteredData;
                this.state.totalRecords = filteredData.length;
                this.renderTable();
                this.updatePagination();
            },

            // 初始化表格编辑功能
            initTableEditable: function() {
                const self = this;
                
                $('.table-editable').on('click', '.edit', function(e) {
                    e.preventDefault();
                    const $btn = $(this);
                    const $row = $btn.closest('tr');
                    
                    if (!$btn.hasClass('active')) {
                        self.enterEditMode($row, $btn);
                    } else {
                        self.saveEdit($row, $btn);
                    }
                });
            },

            // 进入编辑模式
            enterEditMode: function($row, $btn) {
                const predictedCell = $row.find('[data-field="predicted"]');
                const actualCell = $row.find('[data-field="actual"]');
                
                // 获取当前值和单位
                const predictedParts = this.parseValueAndUnit(predictedCell.text());
                const actualParts = this.parseValueAndUnit(actualCell.text());
                
                // 创建编辑输入框
                predictedCell.html(this.createEditInput(predictedParts.value, predictedParts.unit));
                actualCell.html(this.createEditInput(actualParts.value, actualParts.unit));
                
                // 更改按钮状态
                $btn.addClass('active').html(`
                    <i class="fas fa-check text-success me-2"></i>
                    <i class="fas fa-times text-danger"></i>
                `);
                
                // 绑定取消编辑事件
                $btn.find('.fa-times').on('click', (e) => {
                    e.stopPropagation();
                    this.cancelEdit($row, $btn);
                });
                
                // 绑定输入事件以实时计算误差
                $row.find('input').on('input', () => this.calculateError($row));
            },

            // 创建编辑输入框
            createEditInput: function(value, unit) {
                return `
                    <div class="input-group input-group-sm">
                        <input type="number" class="form-control" value="${value}" step="0.1">
                        <span class="input-group-text">${unit}</span>
                    </div>
                `;
            },

            // 解析值和单位
            parseValueAndUnit: function(text) {
                const matches = text.match(/([\d.]+)\s*(.+)/);
                return {
                    value: matches[1],
                    unit: matches[2]
                };
            },

            // 保存编辑
            saveEdit: function($row, $btn) {
                const predictedInput = $row.find('[data-field="predicted"] input');
                const actualInput = $row.find('[data-field="actual"] input');
                
                // 验证输入
                if (!this.validateInputs(predictedInput, actualInput)) {
                    return;
                }
                
                // 获取单位
                const predictedUnit = $row.find('[data-field="predicted"] .input-group-text').text();
                const actualUnit = $row.find('[data-field="actual"] .input-group-text').text();
                
                // 更新数据
                const predictedValue = predictedInput.val() + ' ' + predictedUnit;
                const actualValue = actualInput.val() + ' ' + actualUnit;
                
                // 计算新的误差率和置信度
                const error = this.calculateErrorValue(predictedInput.val(), actualInput.val());
                const confidence = (95 - error * 2).toFixed(0);
                
                // 更新行数据
                $row.find('[data-field="predicted"]').html(predictedValue);
                $row.find('[data-field="actual"]').html(actualValue);
                $row.find('td:eq(4)').text(error.toFixed(2) + '%');
                $row.find('td:eq(5)').text(confidence + '%');
                
                // 更新状态标签
                this.updateStatusBadge($row, error);
                
                // 重置按钮状态
                $btn.removeClass('active').html('<i class="fas fa-pencil-alt"></i>');
                
                // 显示成功提示
                this.showToast('success', '数据已更新');
            },

            // 取消编辑
            cancelEdit: function($row, $btn) {
                const originalData = this.state.data[this.getRowIndex($row)];
                
                // 恢复原始数据
                $row.find('[data-field="predicted"]').html(originalData.predicted);
                $row.find('[data-field="actual"]').html(originalData.actual);
                
                // 重置按钮状态
                $btn.removeClass('active').html('<i class="fas fa-pencil-alt"></i>');
            },

            // 验证输入
            validateInputs: function(...inputs) {
                let isValid = true;
                inputs.forEach(input => {
                    const value = input.val();
                    if (!value || isNaN(value) || value < 0) {
                        input.addClass('is-invalid');
                        isValid = false;
                    } else {
                        input.removeClass('is-invalid');
                    }
                });
                
                if (!isValid) {
                    this.showToast('error', '请输入有效的数值');
                }
                return isValid;
            },

            // 计算误差值
            calculateErrorValue: function(predicted, actual) {
                return Math.abs((predicted - actual) / actual * 100);
            },

            // 更新状态标签
            updateStatusBadge: function($row, error) {
                const $badge = $row.find('td:eq(7) .badge');
                let status, text;
                
                if (error <= 5) {
                    status = 'success';
                    text = '正常';
                } else if (error <= 10) {
                    status = 'warning';
                    text = '警告';
                } else {
                    status = 'danger';
                    text = '错误';
                }
                
                $badge.removeClass('bg-success bg-warning bg-danger')
                      .addClass(`bg-${status}`)
                      .text(text);
            },

            // 初始化导出功能
            initExport: function() {
                const self = this;
                $('#exportData').click(function() {
                    self.showExportDialog();
                });
            },

            // 显示导出对话框
            showExportDialog: function() {
                const self = this;
                Swal.fire({
                    title: '导出数据',
                    html: `
                        <div class="mb-3">
                            <label class="form-label">选择导出格式</label>
                            <div class="btn-group w-100" role="group">
                                <input type="radio" class="btn-check" name="exportFormat" id="exportExcel" value="excel" checked>
                                <label class="btn btn-outline-primary" for="exportExcel">Excel</label>
                                
                                <input type="radio" class="btn-check" name="exportFormat" id="exportCSV" value="csv">
                                <label class="btn btn-outline-primary" for="exportCSV">CSV</label>
                                
                                <input type="radio" class="btn-check" name="exportFormat" id="exportPDF" value="pdf">
                                <label class="btn btn-outline-primary" for="exportPDF">PDF</label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">选择导出范围</label>
                            <select class="form-select" id="exportRange">
                                <option value="current">当前页</option>
                                <option value="filtered">筛选结果</option>
                                <option value="all">全部数据</option>
                            </select>
                        </div>
                    `,
                    showCancelButton: true,
                    confirmButtonText: '导出',
                    cancelButtonText: '取消',
                    preConfirm: () => {
                        return {
                            format: document.querySelector('input[name="exportFormat"]:checked').value,
                            range: document.querySelector('#exportRange').value
                        };
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        self.exportData(result.value);
                    }
                });
            },

            // 执行导出
            exportData: function(options) {
                // 显示加载提示
                Swal.fire({
                    title: '正在导出',
                    html: '请稍候...',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });
                
                // 准备导出数据
                let exportData;
                switch (options.range) {
                    case 'current':
                        const startIdx = (this.state.currentPage - 1) * this.state.pageSize;
                        const endIdx = Math.min(startIdx + this.state.pageSize, this.state.totalRecords);
                        exportData = this.state.data.slice(startIdx, endIdx);
                        break;
                    case 'filtered':
                        exportData = this.state.data;
                        break;
                    case 'all':
                        exportData = this.generateMockData(50); // 这里应该是获取所有原始数据
                        break;
                }
                
                // 模拟导出过程
                setTimeout(() => {
                    console.log('Exporting data:', {
                        format: options.format,
                        data: exportData
                    });
                    
                    // 显示成功提示
                    Swal.fire({
                        icon: 'success',
                        title: '导出成功',
                        text: `数据已导出为${options.format.toUpperCase()}格式`,
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    // 在实际应用中，这里应该触发文件下载
                    // this.downloadFile(exportData, options.format);
                }, 1500);
            },

            // 显示提示消息
            showToast: function(type, message) {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true
                });
                
                Toast.fire({
                    icon: type,
                    title: message
                });
            }
        };

        // 初始化模块
        PredictionDetails.init();
    });
    </script>

    <!-- 添加必要的CSS样式 -->
    <style>
    .table-editable.loading {
        position: relative;
        pointer-events: none;
    }

    .table-editable.loading::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .table-editable .input-group-sm input {
        min-width: 80px;
    }

    .table-editable .edit.active {
        padding: 0.25rem 0.5rem;
    }

    .table-editable .edit.active i {
        cursor: pointer;
    }

    .table-editable .edit.active i:hover {
        opacity: 0.8;
    }
    </style>

    <!-- 添加必要的JavaScript -->
    <script>
    $(document).ready(function() {
        // 初始化工具提示
        $('[data-bs-toggle="tooltip"]').tooltip();
        
        // 刷新建议按钮点击事件
        $('#refreshSuggestions').click(function() {
            // 显示加载动画
            $(this).prop('disabled', true).html('<span class="spinner-border spinner-border-sm"></span> 刷新中...');
            
            // 模拟刷新过程
            setTimeout(() => {
                $(this).prop('disabled', false).html('<i class="fas fa-sync-alt me-1"></i>刷新建议');
                // 这里添加实际的刷新逻辑
            }, 1500);
        });
        
        // 建议类型筛选
        $('.btn-group .btn').click(function() {
            $('.btn-group .btn').removeClass('active');
            $(this).addClass('active');
            // 这里添加实际的筛选逻辑
        });
    });
    </script>

    <!-- 添加图表相关样式 -->
    <style>
    /* 添加图表相关样式 */
    .chart-container {
        position: relative;
        height: 200px;
        width: 100%;
    }

    /* 确保图表容器有合适的背景和边距 */
    .card-body canvas {
        background: rgba(0, 0, 0, 0.02);
        border-radius: 8px;
        padding: 10px;
    }

    /* 时间范围按钮组样式优化 */
    .btn-group .btn {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
    }

    .btn-group .btn.active {
        background-color: #4F8CBE;
        border-color: #4F8CBE;
        color: white;
    }
    </style>

    <!-- 添加图表相关JavaScript -->
    <script>
    // 初始化系统性能图表
    function initSystemPerformanceChart() {
        const ctx = document.getElementById('systemPerformanceChart').getContext('2d');
        const systemPerformanceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                datasets: [{
                    label: '系统响应时间',
                    data: [45, 52, 38, 41, 44, 40],
                    borderColor: '#4F8CBE',
                    backgroundColor: 'rgba(79, 140, 190, 0.1)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
    }

    // 初始化API健康状态图表
    function initApiHealthChart() {
        const ctx = document.getElementById('apiHealthChart').getContext('2d');
        const apiHealthChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array.from({length: 12}, (_, i) => `${i*2}:00`),
                datasets: [{
                    label: 'API响应时间',
                    data: [35, 42, 38, 45, 35, 40, 38, 42, 36, 40, 35, 38],
                    borderColor: '#2ab57d',
                    backgroundColor: 'rgba(42, 181, 125, 0.1)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value + 'ms';
                            }
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
    }

    // 页面加载完成后初始化图表
    document.addEventListener('DOMContentLoaded', function() {
        initSystemPerformanceChart();
        initApiHealthChart();
    });

    // 处理时间范围切换
    document.querySelectorAll('.btn-group .btn').forEach(btn => {
        btn.addEventListener('click', function() {
            // 移除其他按钮的active类
            this.parentElement.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
            // 添加当前按钮的active类
            this.classList.add('active');
            
            // 根据选择的时间范围更新图表数据
            updateChartsData(this.textContent);
        });
    });

    // 更新图表数据的函数
    function updateChartsData(timeRange) {
        // 这里可以根据选择的时间范围发送API请求获取新数据
        // 然后更新图表
        console.log(`Updating charts for ${timeRange} range`);
    }

    // 设置图表容器的样式
    document.getElementById('systemPerformanceChart').parentElement.style.height = '200px';
    document.getElementById('apiHealthChart').parentElement.style.height = '200px';
    </script>

    <!-- 在页面底部添加决策建议相关的JavaScript代码 -->
    <script>
    // 决策建议管理模块
    const DecisionManager = {
        // 状态变量
        suggestions: [],
        history: [],
        historyPage: 1,
        historyPageSize: 10,
        priorityLevels: {
            high: { label: '高', class: 'danger', icon: 'exclamation-circle' },
            medium: { label: '中', class: 'warning', icon: 'exclamation-triangle' },
            low: { label: '低', class: 'info', icon: 'info-circle' }
        },

        // 初始化
        init: function() {
            this.bindEvents();
            this.loadSuggestions();
            this.initCharts();
            
            // 绑定优先级设置事件
            $(document).on('click', '.set-priority', (e) => {
                const $btn = $(e.currentTarget);
                const id = $btn.data('id');
                const priority = $btn.data('priority');
                this.setPriority(id, priority);
            });
        },

        // 绑定事件
        bindEvents: function() {
            // 刷新建议按钮点击事件
            $('#refreshSuggestions').on('click', () => this.refreshSuggestions());
            
            // 建议类型筛选
            $('#suggestionTypeFilter button').on('click', (e) => {
                const $btn = $(e.target);
                $('#suggestionTypeFilter button').removeClass('active');
                $btn.addClass('active');
                this.filterSuggestions($btn.data('type'));
            });
            
            // 历史记录搜索
            $('#historySearch').on('input', (e) => this.searchHistory(e.target.value));
            
            // 历史记录筛选
            $('#historyTypeFilter, #historyStatusFilter').on('change', () => this.filterHistory());
            
            // 导出历史记录
            $('#exportHistory').on('click', () => this.exportHistory());
            
            // 执行建议确认
            $('#confirmExecute').on('click', () => this.executeSuggestion());
        },
        
        // 加载建议列表
        loadSuggestions: function() {
            // 模拟API调用
            setTimeout(() => {
                this.suggestions = this.generateMockSuggestions();
                this.renderSuggestions();
                this.updateStatistics();
            }, 500);
        },
        
        // 生成模拟建议数据
        generateMockSuggestions: function() {
            return [
                {
                    id: 1,
                    time: '14:00',
                    type: 'energy',
                    content: '启动备用燃煤机组',
                    profit: 12000,
                    priority: 'high',
                    reason: [
                        '负荷预测显示15:00-17:00高峰期需求将增加15%',
                        '光伏发电预计下降30%（天气原因）',
                        '当前备用容量率低于安全阈值'
                    ],
                    status: 'pending'
                },
                {
                    id: 2,
                    time: '15:00-17:00',
                    type: 'production',
                    content: '开展需求响应计划',
                    profit: 8500,
                    priority: 'medium',
                    reason: [
                        '电价预测显示高峰期电价将上涨25%',
                        '已有300个用户报名参与需求响应',
                        '预计可削减负荷2000kW'
                    ],
                    status: 'pending'
                },
                {
                    id: 3,
                    time: '16:00',
                    type: 'maintenance',
                    content: '3号变压器预防性检修',
                    profit: -5000,
                    priority: 'high',
                    reason: [
                        '设备监测显示温度异常上升',
                        '已运行时间接近维护周期',
                        '负荷较低，适合开展检修'
                    ],
                    status: 'pending'
                },
                {
                    id: 4,
                    time: '次日9:00-11:00',
                    type: 'energy',
                    content: '增加光伏发电占比',
                    profit: 15000,
                    priority: 'medium',
                    reason: [
                        '天气预报显示日照充足',
                        '光伏发电成本低于火电',
                        '可减少碳排放约15吨'
                    ],
                    status: 'pending'
                },
                {
                    id: 5,
                    time: '立即',
                    type: 'energy',
                    content: '储能系统充电建议',
                    profit: 6800,
                    priority: 'medium',
                    reason: [
                        '当前电价处于低谷期',
                        '储能系统容量低于40%',
                        '预计明日电价上涨可获取差价收益'
                    ],
                    status: 'pending'
                },
                {
                    id: 6,
                    time: '13:30-15:30',
                    type: 'production',
                    content: '工业园区错峰用电',
                    profit: 9200,
                    priority: 'high',
                    reason: [
                        '预计下午用电负荷将超过合同容量',
                        '可避免超容量惩罚性电价',
                        '已与重点企业达成错峰协议'
                    ],
                    status: 'pending'
                },
                {
                    id: 7,
                    time: '次日全天',
                    type: 'maintenance',
                    content: '光伏组件清洗计划',
                    profit: 3500,
                    priority: 'low',
                    reason: [
                        '组件积灰导致发电效率降低5%',
                        '明日天气晴朗适合清洗',
                        '预计清洗后可提升发电量8%'
                    ],
                    status: 'pending'
                },
                {
                    id: 8,
                    time: '立即',
                    type: 'energy',
                    content: '优化风机运行参数',
                    profit: 4200,
                    priority: 'medium',
                    reason: [
                        '风速预计将增加到8m/s',
                        '当前风机运行效率低于最优值',
                        '通过参数调整可提升发电效率'
                    ],
                    status: 'pending'
                },
                {
                    id: 9,
                    time: '19:00-21:00',
                    type: 'production',
                    content: '调整充电桩功率',
                    profit: 5600,
                    priority: 'medium',
                    reason: [
                        '预计晚高峰充电需求增加',
                        '当前充电功率配置不合理',
                        '优化后可提高充电效率和收益'
                    ],
                    status: 'pending'
                },
                {
                    id: 10,
                    time: '次日8:00',
                    type: 'maintenance',
                    content: '配电线路巡检',
                    profit: -2000,
                    priority: 'high',
                    reason: [
                        '系统检测到线路温度波动',
                        '已超过常规巡检周期',
                        '及时巡检可预防故障'
                    ],
                    status: 'pending'
                },
                {
                    id: 11,
                    time: '立即',
                    type: 'energy',
                    content: '启动应急柴油发电机',
                    profit: -3000,
                    priority: 'high',
                    reason: [
                        '主电源负载接近极限',
                        '备用电源容量不足',
                        '防止潜在供电中断风险'
                    ],
                    status: 'pending'
                },
                {
                    id: 12,
                    time: '次日',
                    type: 'production',
                    content: '调整空调系统运行策略',
                    profit: 7800,
                    priority: 'low',
                    reason: [
                        '天气预报显示温度适中',
                        '当前空调能耗偏高',
                        '优化后预计节省15%能耗'
                    ],
                    status: 'pending'
                },
                {
                    id: 13,
                    time: '本周内',
                    type: 'maintenance',
                    content: '更换老化储能电池组',
                    profit: -15000,
                    priority: 'medium',
                    reason: [
                        '当前电池组效率低于70%',
                        '已超过设计使用寿命',
                        '更换后可提升20%储能效率'
                    ],
                    status: 'pending'
                },
                {
                    id: 14,
                    time: '立即',
                    type: 'energy',
                    content: '购买低价外部电力',
                    profit: 11200,
                    priority: 'high',
                    reason: [
                        '现货市场电价处于低位',
                        '可替代部分高成本自发电',
                        '预计可节省发电成本15%'
                    ],
                    status: 'pending'
                },
                {
                    id: 15,
                    time: '下月初',
                    type: 'production',
                    content: '扩建充电站',
                    profit: 45000,
                    priority: 'low',
                    reason: [
                        '现有充电设施使用率超过90%',
                        '用户排队时间过长',
                        '新增设施预计3个月回本'
                    ],
                    status: 'pending'
                }
            ];
        },
        
        // 渲染建议列表
        renderSuggestions: function(suggestions = this.suggestions) {
            const $tbody = $('#suggestionTableBody');
            $tbody.empty();
            
            if (suggestions.length === 0) {
                $tbody.append(`
                    <tr>
                        <td colspan="7" class="text-center">
                            <div class="p-3">
                                <i class="fas fa-inbox fa-2x text-muted mb-2"></i>
                                <p class="mb-0">暂无建议</p>
                            </div>
                        </td>
                    </tr>
                `);
                return;
            }
            
            suggestions.forEach(suggestion => {
                $tbody.append(`
                    <tr data-id="${suggestion.id}">
                        <td>${suggestion.time}</td>
                        <td>
                            <span class="badge bg-${this.getTypeBadgeClass(suggestion.type)}">
                                ${this.getTypeText(suggestion.type)}
                            </span>
                        </td>
                        <td>
                            ${this.getPriorityBadge(suggestion.priority)}
                            ${suggestion.content}
                        </td>
                        <td>+￥${suggestion.profit.toLocaleString()}</td>
                        <td>
                            <button class="btn btn-sm btn-link" data-bs-toggle="tooltip" data-bs-html="true" 
                                title="${this.formatReasons(suggestion.reason)}">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </td>
                        <td>${this.getStatusBadge(suggestion.status)}</td>
                        <td>${this.getActionButtons(suggestion)}</td>
                    </tr>
                `);
            });
            
            // 初始化工具提示
            $('[data-bs-toggle="tooltip"]').tooltip();
        },
        
        // 更新统计数据
        updateStatistics: function() {
            const stats = this.calculateStatistics();
            
            $('#todaySuggestions').text(stats.total + '条');
            $('#suggestionChange').text(`较昨日${stats.change >= 0 ? '+' : ''}${stats.change}条`);
            $('#expectedProfit').text(`¥${stats.profit.toLocaleString()}`);
            $('#profitChange').text(`${stats.profitChange >= 0 ? '+' : ''}${stats.profitChange}%`);
            $('#adoptedSuggestions').text(stats.adopted + '条');
            $('#adoptionRate').text(stats.adoptionRate + '%');
            $('#inProgressSuggestions').text(stats.inProgress + '条');
            $('#completionRate').text(stats.completionRate + '%');
        },
        
        // 计算统计数据
        calculateStatistics: function() {
            return {
                total: this.suggestions.length,
                change: 3,
                profit: this.suggestions.reduce((sum, s) => sum + s.profit, 0),
                profitChange: 15.2,
                adopted: this.suggestions.filter(s => s.status === 'executed').length,
                adoptionRate: 66.7,
                inProgress: this.suggestions.filter(s => s.status === 'in_progress').length,
                completionRate: 60
            };
        },
        
        // 刷新建议列表
        refreshSuggestions: function() {
            const $btn = $('#refreshSuggestions');
            $btn.prop('disabled', true)
                .html('<span class="spinner-border spinner-border-sm"></span> 刷新中...');
            
            // 模拟API调用
            setTimeout(() => {
                this.loadSuggestions();
                $btn.prop('disabled', false)
                    .html('<i class="fas fa-sync-alt me-1"></i>刷新建议');
                
                // 显示提示
                this.showToast('success', '建议列表已更新');
            }, 1000);
        },
        
        // 筛选建议
        filterSuggestions: function(type) {
            if (type === 'all') {
                this.renderSuggestions();
                return;
            }
            
            const filtered = this.suggestions.filter(s => s.type === type);
            this.renderSuggestions(filtered);
        },
        
        // 执行建议
        executeSuggestion: function(id) {
            const suggestion = this.suggestions.find(s => s.id === id);
            if (!suggestion) return;
            
            $('#executeConfirmInfo').text(suggestion.content);
            $('#executeConfirmModal').modal('show');
            
            $('#confirmExecute').one('click', () => {
                $('#executeConfirmModal').modal('hide');
                
                // 更新状态
                suggestion.status = 'in_progress';
                this.renderSuggestions();
                this.updateStatistics();
                
                // 添加到历史记录
                this.addToHistory({
                    ...suggestion,
                    executeTime: new Date().toLocaleString(),
                    actualProfit: Math.round(suggestion.profit * 0.9)
                });
                
                // 显示提示
                this.showToast('success', '建议已开始执行');
            });
        },
        
        // 显示提示消息
        showToast: function(type, message) {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true
            });
            
            Toast.fire({
                icon: type,
                title: message
            });
        },
        
        // 工具方法
        getTypeBadgeClass: function(type) {
            const classes = {
                energy: 'danger',
                production: 'warning',
                maintenance: 'info'
            };
            return classes[type] || 'secondary';
        },
        
        getTypeText: function(type) {
            const texts = {
                energy: '发电调度',
                production: '需求响应',
                maintenance: '设备维护'
            };
            return texts[type] || '其他';
        },
        
        getStatusBadge: function(status) {
            const badges = {
                pending: '<span class="badge bg-warning">待执行</span>',
                in_progress: '<span class="badge bg-primary">执行中</span>',
                executed: '<span class="badge bg-success">已完成</span>',
                cancelled: '<span class="badge bg-secondary">已取消</span>'
            };
            return badges[status] || '';
        },
        
        getActionButtons: function(suggestion) {
            let buttons = '';
            
            if (suggestion.status === 'pending') {
                buttons += `
                    <div class="btn-group">
                        <button class="btn btn-sm btn-primary" onclick="DecisionManager.executeSuggestion(${suggestion.id})">
                            执行
                        </button>
                        
                            <span class="visually-hidden">设置优先级</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><h6 class="dropdown-header">设置优先级</h6></li>
                            <li><a class="dropdown-item set-priority" href="#" data-id="${suggestion.id}" data-priority="high">
                                <i class="fas fa-exclamation-circle text-danger me-2"></i>高优先级
                            </a></li>
                            <li><a class="dropdown-item set-priority" href="#" data-id="${suggestion.id}" data-priority="medium">
                                <i class="fas fa-exclamation-triangle text-warning me-2"></i>中优先级
                            </a></li>
                            <li><a class="dropdown-item set-priority" href="#" data-id="${suggestion.id}" data-priority="low">
                                <i class="fas fa-info-circle text-info me-2"></i>低优先级
                            </a></li>
                        </ul>
                    </div>
                `;
            } else {
                buttons += `
                    <button class="btn btn-sm btn-secondary" onclick="DecisionManager.viewDetail(${suggestion.id})">
                        详情
                    </button>
                `;
            }
            
            return buttons;
        },
        
        formatReasons: function(reasons) {
            return reasons.map(r => `<p>${r}</p>`).join('');
        },
        
        // 历史记录管理
        addToHistory: function(suggestion) {
            this.history.unshift({
                id: Date.now(),
                executeTime: new Date().toLocaleString(),
                type: suggestion.type,
                content: suggestion.content,
                expectedProfit: suggestion.profit,
                actualProfit: suggestion.actualProfit || 0,
                status: suggestion.status,
                executor: '张明', // 当前登录用户
                remarks: ''
            });
            this.updateHistoryView();
        },
        
        // 更新历史记录视图
        updateHistoryView: function() {
            const $tbody = $('#historyTableBody');
            $tbody.empty();
            
            const start = (this.historyPage - 1) * this.historyPageSize;
            const end = start + this.historyPageSize;
            const pageData = this.history.slice(start, end);
            
            pageData.forEach(record => {
                $tbody.append(`
                    <tr>
                        <td>${record.executeTime}</td>
                        <td><span class="badge bg-${this.getTypeBadgeClass(record.type)}">${this.getTypeText(record.type)}</span></td>
                        <td>${record.content}</td>
                        <td>${record.actualProfit >= 0 ? '+' : ''}￥${record.actualProfit.toLocaleString()}</td>
                        <td>${this.getStatusBadge(record.status)}</td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="DecisionManager.viewHistoryDetail(${record.id})">
                                <i class="fas fa-eye me-1"></i>详情
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="DecisionManager.addRemark(${record.id})">
                                <i class="fas fa-comment me-1"></i>备注
                            </button>
                        </td>
                    </tr>
                `);
            });
            
            // 更新分页
            this.updateHistoryPagination();
            // 更新总数
            $('#totalHistory').text(this.history.length);
        },
        
        // 更新历史记录分页
        updateHistoryPagination: function() {
            const totalPages = Math.ceil(this.history.length / this.historyPageSize);
            const $pagination = $('#historyPagination');
            $pagination.empty();
            
            // 上一页
            $pagination.append(`
                <li class="page-item ${this.historyPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="DecisionManager.changePage(${this.historyPage - 1})">
                        <i class="mdi mdi-chevron-left"></i>
                    </a>
                </li>
            `);
            
            // 页码
            for (let i = 1; i <= totalPages; i++) {
                $pagination.append(`
                    <li class="page-item ${i === this.historyPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="DecisionManager.changePage(${i})">${i}</a>
                    </li>
                `);
            }
            
            // 下一页
            $pagination.append(`
                <li class="page-item ${this.historyPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="DecisionManager.changePage(${this.historyPage + 1})">
                        <i class="mdi mdi-chevron-right"></i>
                    </a>
                </li>
            `);
        },
        
        // 切换历史记录页面
        changePage: function(page) {
            if (page < 1 || page > Math.ceil(this.history.length / this.historyPageSize)) return;
            this.historyPage = page;
            this.updateHistoryView();
        },
        
        // 查看历史记录详情
        viewHistoryDetail: function(id) {
            const record = this.history.find(h => h.id === id);
            if (!record) return;
            
            const $modal = $('#suggestionDetailModal');
            $modal.find('.modal-title').text('执行详情');
            $modal.find('.suggestion-detail').html(`
                <div class="mb-3">
                    <h6 class="text-muted">基本信息</h6>
                    <table class="table table-sm">
                        <tr>
                            <th width="120">执行时间</th>
                            <td>${record.executeTime}</td>
                        </tr>
                        <tr>
                            <th>决策类型</th>
                            <td><span class="badge bg-${this.getTypeBadgeClass(record.type)}">${this.getTypeText(record.type)}</span></td>
                        </tr>
                        <tr>
                            <th>执行人</th>
                            <td>${record.executor}</td>
                        </tr>
                        <tr>
                            <th>执行状态</th>
                            <td>${this.getStatusBadge(record.status)}</td>
                        </tr>
                    </table>
                </div>
                <div class="mb-3">
                    <h6 class="text-muted">收益分析</h6>
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="border rounded p-3">
                                <small class="text-muted d-block">预期收益</small>
                                <h4 class="mb-0">￥${record.expectedProfit.toLocaleString()}</h4>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="border rounded p-3">
                                <small class="text-muted d-block">实际收益</small>
                                <h4 class="mb-0">￥${record.actualProfit.toLocaleString()}</h4>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <h6 class="text-muted">备注信息</h6>
                    <p class="mb-0">${record.remarks || '暂无备注'}</p>
                </div>
            `);
            
            // 隐藏执行按钮
            $modal.find('#executeSuggestion').hide();
            $modal.modal('show');
        },
        
        // 添加备注
        addRemark: function(id) {
            const record = this.history.find(h => h.id === id);
            if (!record) return;
            
            Swal.fire({
                title: '添加备注',
                input: 'textarea',
                inputValue: record.remarks || '',
                inputPlaceholder: '请输入备注信息...',
                showCancelButton: true,
                confirmButtonText: '保存',
                cancelButtonText: '取消',
                inputValidator: (value) => {
                    if (!value) {
                        return '请输入备注内容';
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    record.remarks = result.value;
                    this.updateHistoryView();
                    this.showToast('success', '备注已保存');
                }
            });
        },
        
        // 导出历史记录
        exportHistory: function() {
            const exportTypes = ['Excel', 'PDF', 'CSV'];
            
            Swal.fire({
                title: '导出历史记录',
                html: `
                    <div class="mb-3">
                        <label class="form-label">选择导出格式</label>
                        <div class="btn-group w-100">
                            ${exportTypes.map(type => `
                                <input type="radio" class="btn-check" name="exportType" id="export${type}" value="${type}" ${type === 'Excel' ? 'checked' : ''}>
                                <label class="btn btn-outline-primary" for="export${type}">${type}</label>
                            `).join('')}
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">选择导出范围</label>
                        <select class="form-select" id="exportRange">
                            <option value="all">全部记录</option>
                            <option value="filtered">筛选结果</option>
                            <option value="selected">选中记录</option>
                        </select>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: '导出',
                cancelButtonText: '取消'
            }).then((result) => {
                if (result.isConfirmed) {
                    const type = document.querySelector('input[name="exportType"]:checked').value;
                    const range = document.querySelector('#exportRange').value;
                    
                    // 显示加载提示
                    Swal.fire({
                        title: '正在导出',
                        html: '请稍候...',
                        allowOutsideClick: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });
                    
                    // 模拟导出过程
                    setTimeout(() => {
                        Swal.fire({
                            icon: 'success',
                            title: '导出成功',
                            text: `文件已导出为${type}格式`,
                            timer: 2000,
                            showConfirmButton: false
                        });
                    }, 1500);
                }
            });
        },
        
        // 搜索历史记录
        searchHistory: function(keyword) {
            if (!keyword) {
                this.updateHistoryView();
                return;
            }
            
            const filtered = this.history.filter(record => 
                record.content.toLowerCase().includes(keyword.toLowerCase()) ||
                record.executor.toLowerCase().includes(keyword.toLowerCase()) ||
                record.remarks.toLowerCase().includes(keyword.toLowerCase())
            );
            
            this.renderFilteredHistory(filtered);
        },
        
        // 渲染筛选后的历史记录
        renderFilteredHistory: function(records) {
            const $tbody = $('#historyTableBody');
            $tbody.empty();
            
            if (records.length === 0) {
                $tbody.append(`
                    <tr>
                        <td colspan="6" class="text-center">
                            <div class="p-3">
                                <i class="fas fa-search fa-2x text-muted mb-2"></i>
                                <p class="mb-0">未找到匹配的记录</p>
                            </div>
                        </td>
                    </tr>
                `);
                return;
            }
            
            records.forEach(record => {
                $tbody.append(`
                    <tr>
                        <td>${record.executeTime}</td>
                        <td><span class="badge bg-${this.getTypeBadgeClass(record.type)}">${this.getTypeText(record.type)}</span></td>
                        <td>${record.content}</td>
                        <td>${record.actualProfit >= 0 ? '+' : ''}￥${record.actualProfit.toLocaleString()}</td>
                        <td>${this.getStatusBadge(record.status)}</td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="DecisionManager.viewHistoryDetail(${record.id})">
                                <i class="fas fa-eye me-1"></i>详情
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="DecisionManager.addRemark(${record.id})">
                                <i class="fas fa-comment me-1"></i>备注
                            </button>
                        </td>
                    </tr>
                `);
            });
            
            $('#totalHistory').text(records.length);
        },
        
        // 设置建议优先级
        setPriority: function(id, priority) {
            const suggestion = this.suggestions.find(s => s.id === id);
            if (!suggestion) return;
            
            suggestion.priority = priority;
            this.renderSuggestions();
            this.showToast('success', '优先级已更新');
        },
        
        // 获取优先级标签
        getPriorityBadge: function(priority) {
            const p = this.priorityLevels[priority] || this.priorityLevels.low;
            return `
                <span class="badge bg-${p.class}">
                    <i class="fas fa-${p.icon} me-1"></i>${p.label}
                </span>
            `;
        }
    };

    // 页面加载完成后初始化
    $(document).ready(function() {
        DecisionManager.init();
    });
    </script>
</html>